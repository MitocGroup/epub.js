!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ePub=t()}}(function(){var t;return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e){function n(t){return t&&r[t.split(".").pop().toLowerCase()]||o}var i={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},r=function(){var t,e,n,r,o={};for(t in i)if(i.hasOwnProperty(t))for(e in i[t])if(i[t].hasOwnProperty(e))if(n=i[t][e],"string"==typeof n)o[n]=t+"/"+e;else for(r=0;r<n.length;r++)o[n[r]]=t+"/"+e;return o}(),o="text/plain";e.exports={lookup:n}},{}],2:[function(t,e){function n(){u&&s&&(u=!1,s.length?h=s.concat(h):c=-1,h.length&&i())}function i(){if(!u){var t=setTimeout(n);u=!0;for(var e=h.length;e;){for(s=h,h=[];++c<e;)s&&s[c].run();c=-1,e=h.length}s=null,u=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function o(){}var s,a=e.exports={},h=[],u=!1,c=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new r(t,e)),1!==h.length||u||setTimeout(i,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(e,n){(function(i,r){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function s(t){return"function"==typeof t}function a(t){return"object"==typeof t&&null!==t}function h(){}function u(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1}function c(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e}function p(t,e){return"onerror"===t?(Ce.on("error",e),void 0):2!==arguments.length?Ce[t]:(Ce[t]=e,void 0)}function l(){setTimeout(function(){for(var t,e=0;e<Ne.length;e++){t=Ne[e];var n=t.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),Ce.trigger(t.name,t.payload)}Ne.length=0},50)}function d(t,e,n){1===Ne.push({name:t,payload:{key:e._guidKey,id:e._id,eventName:t,detail:e._result,childId:n&&n._id,label:e._label,timeStamp:Ee(),error:Ce["instrument-with-stack"]?new Error(e._label):null}})&&l()}function f(t,e,n){var i=this,r=i._state;if(r===Ue&&!t||r===De&&!e)return Ce.instrument&&ze("chained",i,i),i;i._onError=null;var o=new i.constructor(S,n),s=i._result;if(Ce.instrument&&ze("chained",i,o),r){var a=arguments[r-1];Ce.async(function(){B(r,o,a,s)})}else O(i,o,t,e);return o}function g(t,e){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var i=new n(S,e);return A(i,t),i}function m(t,e,n){return t===Ue?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function v(t,e,n,i){this._instanceConstructor=t,this.promise=new t(S,i),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&P(this.promise,this._result))):j(this.promise,this._validationError())}function y(t,e){return new Re(this,t,!0,e).promise}function b(t,e){function n(t){A(o,t)}function i(t){j(o,t)}var r=this,o=new r(S,e);if(!ke(t))return j(o,new TypeError("You must pass an array to race.")),o;for(var s=t.length,a=0;o._state===Be&&s>a;a++)O(r.resolve(t[a]),void 0,n,i);return o}function w(t,e){var n=this,i=new n(S,e);return j(i,t),i}function x(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function _(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function k(t,e){this._id=Ie++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],Ce.instrument&&ze("created",this),S!==t&&("function"!=typeof t&&x(),this instanceof k?U(this,t):_())}function E(){return new TypeError("A promises callback cannot return that same promise.")}function S(){}function T(t){try{return t.then}catch(e){return Qe.error=e,Qe}}function C(t,e,n,i){try{t.call(e,n,i)}catch(r){return r}}function N(t,e,n){Ce.async(function(t){var i=!1,r=C(n,e,function(n){i||(i=!0,e!==n?A(t,n,void 0):P(t,n))},function(e){i||(i=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!i&&r&&(i=!0,j(t,r))},t)}function z(t,e){e._state===Ue?P(t,e._result):e._state===De?(e._onError=null,j(t,e._result)):O(e,void 0,function(n){e!==n?A(t,n,void 0):P(t,n)},function(e){j(t,e)})}function q(t,e,n){e.constructor===t.constructor&&n===qe&&constructor.resolve===Ae?z(t,e):n===Qe?j(t,Qe.error):void 0===n?P(t,e):s(n)?N(t,e,n):P(t,e)}function A(t,e){t===e?P(t,e):o(e)?q(t,e,T(e)):P(t,e)}function R(t){t._onError&&t._onError(t._result),L(t)}function P(t,e){t._state===Be&&(t._result=e,t._state=Ue,0===t._subscribers.length?Ce.instrument&&ze("fulfilled",t):Ce.async(L,t))}function j(t,e){t._state===Be&&(t._state=De,t._result=e,Ce.async(R,t))}function O(t,e,n,i){var r=t._subscribers,o=r.length;t._onError=null,r[o]=e,r[o+Ue]=n,r[o+De]=i,0===o&&t._state&&Ce.async(L,t)}function L(t){var e=t._subscribers,n=t._state;if(Ce.instrument&&ze(n===Ue?"fulfilled":"rejected",t),0!==e.length){for(var i,r,o=t._result,s=0;s<e.length;s+=3)i=e[s],r=e[s+n],i?B(n,i,r,o):r(o);t._subscribers.length=0}}function I(){this.error=null}function F(t,e){try{return t(e)}catch(n){return Me.error=n,Me}}function B(t,e,n,i){var r,o,a,h,u=s(n);if(u){if(r=F(n,i),r===Me?(h=!0,o=r.error,r=null):a=!0,e===r)return j(e,E()),void 0}else r=i,a=!0;e._state!==Be||(u&&a?A(e,r):h?j(e,o):t===Ue?P(e,r):t===De&&j(e,r))}function U(t,e){var n=!1;try{e(function(e){n||(n=!0,A(t,e))},function(e){n||(n=!0,j(t,e))})}catch(i){j(t,i)}}function D(t,e,n){this._superConstructor(t,e,!1,n)}function Q(t,e){return new D(Fe,t,e).promise}function M(t,e){return Fe.all(t,e)}function H(t,e){en[$e]=t,en[$e+1]=e,$e+=2,2===$e&&We()}function W(){var t=i.nextTick,e=i.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(e)&&"0"===e[1]&&"10"===e[2]&&(t=setImmediate),function(){t(Y)}}function X(){return function(){He(Y)}}function V(){var t=0,e=new Ge(Y),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function $(){var t=new MessageChannel;return t.port1.onmessage=Y,function(){t.port2.postMessage(0)}}function Z(){return function(){setTimeout(Y,1)}}function Y(){for(var t=0;$e>t;t+=2){var e=en[t],n=en[t+1];e(n),en[t]=void 0,en[t+1]=void 0}$e=0}function J(){try{var t=e,n=t("vertx");return He=n.runOnLoop||n.runOnContext,X()}catch(i){return Z()}}function G(t){var e={};return e.promise=new Fe(function(t,n){e.resolve=t,e.reject=n},t),e}function K(t,e,n){return Fe.all(t,n).then(function(t){if(!s(e))throw new TypeError("You must pass a function as filter's second argument.");for(var i=t.length,r=new Array(i),o=0;i>o;o++)r[o]=e(t[o]);return Fe.all(r,n).then(function(e){for(var n=new Array(i),r=0,o=0;i>o;o++)e[o]&&(n[r]=t[o],r++);return n.length=r,n})})}function te(t,e,n){this._superConstructor(t,e,!0,n)}function ee(t,e,n){this._superConstructor(t,e,!1,n)}function ne(t,e){return new ee(Fe,t,e).promise}function ie(t,e){return new on(Fe,t,e).promise}function re(t,e,n){return Fe.all(t,n).then(function(t){if(!s(e))throw new TypeError("You must pass a function as map's second argument.");for(var i=t.length,r=new Array(i),o=0;i>o;o++)r[o]=e(t[o]);return Fe.all(r,n)})}function oe(){this.value=void 0}function se(t){try{return t.then}catch(e){return cn.value=e,cn}}function ae(t,e,n){try{t.apply(e,n)}catch(i){return cn.value=i,cn}}function he(t,e){for(var n,i,r={},o=t.length,s=new Array(o),a=0;o>a;a++)s[a]=t[a];for(i=0;i<e.length;i++)n=e[i],r[n]=s[i+1];return r}function ue(t){for(var e=t.length,n=new Array(e-1),i=1;e>i;i++)n[i-1]=t[i];return n}function ce(t,e){return{then:function(n,i){return t.call(e,n,i)}}}function pe(t,e){var n=function(){for(var n,i=this,r=arguments.length,o=new Array(r+1),s=!1,a=0;r>a;++a){if(n=arguments[a],!s){if(s=fe(n),s===pn){var h=new Fe(S);return j(h,pn.value),h}s&&s!==!0&&(n=ce(s,n))}o[a]=n}var u=new Fe(S);return o[r]=function(t,n){t?j(u,t):void 0===e?A(u,n):e===!0?A(u,ue(arguments)):ke(e)?A(u,he(arguments,e)):A(u,n)},s?de(u,o,t,i):le(u,o,t,i)};return n.__proto__=t,n}function le(t,e,n,i){var r=ae(n,i,e);return r===cn&&j(t,r.value),t}function de(t,e,n,i){return Fe.all(e).then(function(e){var r=ae(n,i,e);return r===cn&&j(t,r.value),t})}function fe(t){return t&&"object"==typeof t?t.constructor===Fe?!0:se(t):!1}function ge(t,e){return Fe.race(t,e)}function me(t,e){return Fe.reject(t,e)}function ve(t,e){return Fe.resolve(t,e)}function ye(t){throw setTimeout(function(){throw t}),t}function be(t,e){Ce.async(t,e)}function we(){Ce.on.apply(Ce,arguments)}function xe(){Ce.off.apply(Ce,arguments)}var _e;_e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var ke=_e,Ee=Date.now||function(){return(new Date).getTime()},Se=Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return h.prototype=t,new h},Te={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(t,e){if("function"!=typeof e)throw new TypeError("Callback must be a function");var n,i=c(this);n=i[t],n||(n=i[t]=[]),-1===u(n,e)&&n.push(e)},off:function(t,e){var n,i,r=c(this);return e?(n=r[t],i=u(n,e),-1!==i&&n.splice(i,1),void 0):(r[t]=[],void 0)},trigger:function(t,e,n){var i,r,o=c(this);if(i=o[t])for(var s=0;s<i.length;s++)r=i[s],r(e,n)}},Ce={instrument:!1};Te.mixin(Ce);var Ne=[],ze=d,qe=f,Ae=g,Re=v;v.prototype._validateInput=function(t){return ke(t)},v.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},v.prototype._init=function(){this._result=new Array(this.length)},v.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,i=0;e._state===Be&&t>i;i++)this._eachEntry(n[i],i)},v.prototype._settleMaybeThenable=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===Ae){var r=T(t);if(r===qe&&t._state!==Be)t._onError=null,this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=this._makeResult(Ue,e,t);else if(n===Fe){var o=new n(S);q(o,t,r),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){e(t)}),e)}else this._willSettleAt(i(t),e)},v.prototype._eachEntry=function(t,e){a(t)?this._settleMaybeThenable(t,e):(this._remaining--,this._result[e]=this._makeResult(Ue,e,t))},v.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===Be&&(this._remaining--,this._abortOnReject&&t===De?j(i,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&P(i,this._result)},v.prototype._makeResult=function(t,e,n){return n},v.prototype._willSettleAt=function(t,e){var n=this;O(t,void 0,function(t){n._settledAt(Ue,e,t)},function(t){n._settledAt(De,e,t)})};var Pe=y,je=b,Oe=w,Le="rsvp_"+Ee()+"-",Ie=0,Fe=k;k.cast=Ae,k.all=Pe,k.race=je,k.resolve=Ae,k.reject=Oe,k.prototype={constructor:k,_guidKey:Le,_onError:function(t){var e=this;Ce.after(function(){e._onError&&Ce.trigger("error",t,e._label)})},then:qe,"catch":function(t,e){return this.then(void 0,t,e)},"finally":function(t,e){var n=this,i=n.constructor;return n.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){return i.reject(e)})},e)}};var Be=void 0,Ue=1,De=2,Qe=new I,Me=new I;D.prototype=Se(Re.prototype),D.prototype._superConstructor=Re,D.prototype._makeResult=m,D.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var He,We,Xe=Q,Ve=M,$e=0,Ze=({}.toString,H),Ye="undefined"!=typeof window?window:void 0,Je=Ye||{},Ge=Je.MutationObserver||Je.WebKitMutationObserver,Ke="undefined"==typeof self&&"undefined"!=typeof i&&"[object process]"==={}.toString.call(i),tn="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,en=new Array(1e3);We=Ke?W():Ge?V():tn?$():void 0===Ye&&"function"==typeof e?J():Z();var nn=G,rn=K,on=te;te.prototype=Se(Re.prototype),te.prototype._superConstructor=Re,te.prototype._init=function(){this._result={}},te.prototype._validateInput=function(t){return t&&"object"==typeof t},te.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},te.prototype._enumerate=function(){var t=this,e=t.promise,n=t._input,i=[];for(var r in n)e._state===Be&&Object.prototype.hasOwnProperty.call(n,r)&&i.push({position:r,entry:n[r]});var o=i.length;t._remaining=o;for(var s,a=0;e._state===Be&&o>a;a++)s=i[a],t._eachEntry(s.entry,s.position)},ee.prototype=Se(on.prototype),ee.prototype._superConstructor=Re,ee.prototype._makeResult=m,ee.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var sn,an=ne,hn=ie,un=re,cn=new oe,pn=new oe,ln=pe;if("object"==typeof self)sn=self;else{if("object"!=typeof r)throw new Error("no global: `self` or `global` found");sn=r}var dn=sn,fn=ge,gn=me,mn=ve,vn=ye;Ce.async=Ze,Ce.after=function(t){setTimeout(t,0)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var yn=window.__PROMISE_INSTRUMENTATION__;p("instrument",!0);for(var bn in yn)yn.hasOwnProperty(bn)&&we(bn,yn[bn])}var wn={race:fn,Promise:Fe,allSettled:Xe,hash:hn,hashSettled:an,denodeify:ln,on:we,off:xe,map:un,filter:rn,resolve:mn,reject:gn,all:Ve,rethrow:vn,defer:nn,EventTarget:Te,configure:p,async:be};"function"==typeof t&&t.amd?t(function(){return wn}):"undefined"!=typeof n&&n.exports?n.exports=wn:"undefined"!=typeof dn&&(dn.RSVP=wn)}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],4:[function(e,n,i){!function(e,r){"use strict";"object"==typeof i?n.exports=r():"function"==typeof t&&t.amd?t(r):e.IPv6=r(e)}(this,function(t){"use strict";function e(t){var e=t.toLowerCase(),n=e.split(":"),i=n.length,r=8;""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[i-1]&&""===n[i-2]&&n.pop(),i=n.length,-1!==n[i-1].indexOf(".")&&(r=7);var o;for(o=0;i>o&&""!==n[o];o++);if(r>o)for(n.splice(o,1,"0000");n.length<r;)n.splice(o,0,"0000");for(var s,a=0;r>a;a++){s=n[a].split("");for(var h=0;3>h&&("0"===s[0]&&s.length>1);h++)s.splice(0,1);n[a]=s.join("")}var u=-1,c=0,p=0,l=-1,d=!1;for(a=0;r>a;a++)d?"0"===n[a]?p+=1:(d=!1,p>c&&(u=l,c=p)):"0"===n[a]&&(d=!0,l=a,p=1);p>c&&(u=l,c=p),c>1&&n.splice(u,c,""),i=n.length;var f="";for(""===n[0]&&(f=":"),a=0;i>a&&(f+=n[a],a!==i-1);a++)f+=":";return""===n[i-1]&&(f+=":"),f}function n(){return t.IPv6===this&&(t.IPv6=i),this}var i=t&&t.IPv6;return{best:e,noConflict:n}})},{}],5:[function(e,n,i){!function(e,r){"use strict";"object"==typeof i?n.exports=r():"function"==typeof t&&t.amd?t(r):e.SecondLevelDomains=r(e)}(this,function(t){"use strict";var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ","do":" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ","in":" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(t){var e=t.lastIndexOf(".");if(0>=e||e>=t.length-1)return!1;var i=t.lastIndexOf(".",e-1);if(0>=i||i>=e-1)return!1;var r=n.list[t.slice(e+1)];return r?r.indexOf(" "+t.slice(i+1,e)+" ")>=0:!1},is:function(t){var e=t.lastIndexOf(".");if(0>=e||e>=t.length-1)return!1;var i=t.lastIndexOf(".",e-1);if(i>=0)return!1;var r=n.list[t.slice(e+1)];return r?r.indexOf(" "+t.slice(0,e)+" ")>=0:!1},get:function(t){var e=t.lastIndexOf(".");if(0>=e||e>=t.length-1)return null;var i=t.lastIndexOf(".",e-1);if(0>=i||i>=e-1)return null;var r=n.list[t.slice(e+1)];return r?r.indexOf(" "+t.slice(i+1,e)+" ")<0?null:t.slice(i+1):null},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})},{}],6:[function(e,n,i){!function(r,o){"use strict";"object"==typeof i?n.exports=o(e("./punycode"),e("./IPv6"),e("./SecondLevelDomains")):"function"==typeof t&&t.amd?t(["./punycode","./IPv6","./SecondLevelDomains"],o):r.URI=o(r.punycode,r.IPv6,r.SecondLevelDomains,r)}(this,function(t,e,n,i){"use strict";function r(t,e){var n=arguments.length>=1,i=arguments.length>=2;if(!(this instanceof r))return n?i?new r(t,e):new r(t):new r;if(void 0===t){if(n)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}function o(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function s(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function a(t){return"Array"===s(t)}function h(t,e){var n,i,r={};if("RegExp"===s(e))r=null;else if(a(e))for(n=0,i=e.length;i>n;n++)r[e[n]]=!0;else r[e]=!0;for(n=0,i=t.length;i>n;n++){var o=r&&void 0!==r[t[n]]||!r&&e.test(t[n]);o&&(t.splice(n,1),i--,n--)}return t}function u(t,e){var n,i;if(a(e)){for(n=0,i=e.length;i>n;n++)if(!u(t,e[n]))return!1;return!0}var r=s(e);for(n=0,i=t.length;i>n;n++)if("RegExp"===r){if("string"==typeof t[n]&&t[n].match(e))return!0}else if(t[n]===e)return!0;return!1}function c(t,e){if(!a(t)||!a(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var n=0,i=t.length;i>n;n++)if(t[n]!==e[n])return!1;return!0}function p(t){var e=/^\/+|\/+$/g;return t.replace(e,"")}function l(t){return escape(t)}function d(t){return encodeURIComponent(t).replace(/[!'()*]/g,l).replace(/\*/g,"%2A")}function f(t){return function(e,n){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!n),this)}}function g(t,e){return function(n,i){return void 0===n?this._parts[t]||"":(null!==n&&(n+="",n.charAt(0)===e&&(n=n.substring(1))),this._parts[t]=n,this.build(!i),this)}}var m=i&&i.URI;r.version="1.18.0";var v=r.prototype,y=Object.prototype.hasOwnProperty;r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\.-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(t){if(!t||!t.nodeName)return void 0;var e=t.nodeName.toLowerCase();return"input"===e&&"image"!==t.type?void 0:r.domAttributes[e]},r.encode=d,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=d,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(t,e){var n=r.encode(t+"");return void 0===e&&(e=r.escapeQuerySpace),e?n.replace(/%20/g,"+"):n},r.decodeQuery=function(t,e){t+="",void 0===e&&(e=r.escapeQuerySpace);try{return r.decode(e?t.replace(/\+/g,"%20"):t)}catch(n){return t}};var b,w={encode:"encode",decode:"decode"},x=function(t,e){return function(n){try{return r[e](n+"").replace(r.characters[t][e].expression,function(n){return r.characters[t][e].map[n]
})}catch(i){return n}}};for(b in w)r[b+"PathSegment"]=x("pathname",w[b]),r[b+"UrnPathSegment"]=x("urnpath",w[b]);var _=function(t,e,n){return function(i){var o;o=n?function(t){return r[e](r[n](t))}:r[e];for(var s=(i+"").split(t),a=0,h=s.length;h>a;a++)s[a]=o(s[a]);return s.join(t)}};r.decodePath=_("/","decodePathSegment"),r.decodeUrnPath=_(":","decodeUrnPathSegment"),r.recodePath=_("/","encodePathSegment","decode"),r.recodeUrnPath=_(":","encodeUrnPathSegment","decode"),r.encodeReserved=x("reserved","encode"),r.parse=function(t,e){var n;return e||(e={}),n=t.indexOf("#"),n>-1&&(e.fragment=t.substring(n+1)||null,t=t.substring(0,n)),n=t.indexOf("?"),n>-1&&(e.query=t.substring(n+1)||null,t=t.substring(0,n)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=r.parseAuthority(t,e)):(n=t.indexOf(":"),n>-1&&(e.protocol=t.substring(0,n)||null,e.protocol&&!e.protocol.match(r.protocol_expression)?e.protocol=void 0:"//"===t.substring(n+1,n+3)?(t=t.substring(n+3),t=r.parseAuthority(t,e)):(t=t.substring(n+1),e.urn=!0))),e.path=t,e},r.parseHost=function(t,e){t=t.replace(/\\/g,"/");var n,i,r=t.indexOf("/");if(-1===r&&(r=t.length),"["===t.charAt(0))n=t.indexOf("]"),e.hostname=t.substring(1,n)||null,e.port=t.substring(n+2,r)||null,"/"===e.port&&(e.port=null);else{var o=t.indexOf(":"),s=t.indexOf("/"),a=t.indexOf(":",o+1);-1!==a&&(-1===s||s>a)?(e.hostname=t.substring(0,r)||null,e.port=null):(i=t.substring(0,r).split(":"),e.hostname=i[0]||null,e.port=i[1]||null)}return e.hostname&&"/"!==t.substring(r).charAt(0)&&(r++,t="/"+t),t.substring(r)||"/"},r.parseAuthority=function(t,e){return t=r.parseUserinfo(t,e),r.parseHost(t,e)},r.parseUserinfo=function(t,e){var n,i=t.indexOf("/"),o=t.lastIndexOf("@",i>-1?i:t.length-1);return o>-1&&(-1===i||i>o)?(n=t.substring(0,o).split(":"),e.username=n[0]?r.decode(n[0]):null,n.shift(),e.password=n[0]?r.decode(n.join(":")):null,t=t.substring(o+1)):(e.username=null,e.password=null),t},r.parseQuery=function(t,e){if(!t)return{};if(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!t)return{};for(var n,i,o,s={},a=t.split("&"),h=a.length,u=0;h>u;u++)n=a[u].split("="),i=r.decodeQuery(n.shift(),e),o=n.length?r.decodeQuery(n.join("="),e):null,y.call(s,i)?(("string"==typeof s[i]||null===s[i])&&(s[i]=[s[i]]),s[i].push(o)):s[i]=o;return s},r.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=r.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},r.buildHost=function(t){var e="";return t.hostname?(e+=r.ip6_expression.test(t.hostname)?"["+t.hostname+"]":t.hostname,t.port&&(e+=":"+t.port),e):""},r.buildAuthority=function(t){return r.buildUserinfo(t)+r.buildHost(t)},r.buildUserinfo=function(t){var e="";return t.username&&(e+=r.encode(t.username)),t.password&&(e+=":"+r.encode(t.password)),e&&(e+="@"),e},r.buildQuery=function(t,e,n){var i,o,s,h,u="";for(o in t)if(y.call(t,o)&&o)if(a(t[o]))for(i={},s=0,h=t[o].length;h>s;s++)void 0!==t[o][s]&&void 0===i[t[o][s]+""]&&(u+="&"+r.buildQueryParameter(o,t[o][s],n),e!==!0&&(i[t[o][s]+""]=!0));else void 0!==t[o]&&(u+="&"+r.buildQueryParameter(o,t[o],n));return u.substring(1)},r.buildQueryParameter=function(t,e,n){return r.encodeQuery(t,n)+(null!==e?"="+r.encodeQuery(e,n):"")},r.addQuery=function(t,e,n){if("object"==typeof e)for(var i in e)y.call(e,i)&&r.addQuery(t,i,e[i]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return t[e]=n,void 0;"string"==typeof t[e]&&(t[e]=[t[e]]),a(n)||(n=[n]),t[e]=(t[e]||[]).concat(n)}},r.removeQuery=function(t,e,n){var i,o,u;if(a(e))for(i=0,o=e.length;o>i;i++)t[e[i]]=void 0;else if("RegExp"===s(e))for(u in t)e.test(u)&&(t[u]=void 0);else if("object"==typeof e)for(u in e)y.call(e,u)&&r.removeQuery(t,u,e[u]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===s(n)?t[e]=!a(t[e])&&n.test(t[e])?void 0:h(t[e],n):t[e]!==String(n)||a(n)&&1!==n.length?a(t[e])&&(t[e]=h(t[e],n)):t[e]=void 0:t[e]=void 0}},r.hasQuery=function(t,e,n,i){switch(s(e)){case"String":break;case"RegExp":for(var o in t)if(y.call(t,o)&&e.test(o)&&(void 0===n||r.hasQuery(t,o,n)))return!0;return!1;case"Object":for(var h in e)if(y.call(e,h)&&!r.hasQuery(t,h,e[h]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(s(n)){case"Undefined":return e in t;case"Boolean":var p=Boolean(a(t[e])?t[e].length:t[e]);return n===p;case"Function":return!!n(t[e],e,t);case"Array":if(!a(t[e]))return!1;var l=i?u:c;return l(t[e],n);case"RegExp":return a(t[e])?i?u(t[e],n):!1:Boolean(t[e]&&t[e].match(n));case"Number":n=String(n);case"String":return a(t[e])?i?u(t[e],n):!1:t[e]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var t=[],e=[],n=0,i=0;i<arguments.length;i++){var o=new r(arguments[i]);t.push(o);for(var s=o.segment(),a=0;a<s.length;a++)"string"==typeof s[a]&&e.push(s[a]),s[a]&&n++}if(!e.length||!n)return new r("");var h=new r("").segment(e);return(""===t[0].path()||"/"===t[0].path().slice(0,1))&&h.path("/"+h.path()),h.normalize()},r.commonPath=function(t,e){var n,i=Math.min(t.length,e.length);for(n=0;i>n;n++)if(t.charAt(n)!==e.charAt(n)){n--;break}return 1>n?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":(("/"!==t.charAt(n)||"/"!==e.charAt(n))&&(n=t.substring(0,n).lastIndexOf("/")),t.substring(0,n+1))},r.withinString=function(t,e,n){n||(n={});var i=n.start||r.findUri.start,o=n.end||r.findUri.end,s=n.trim||r.findUri.trim,a=/[a-z0-9-]=["']?$/i;for(i.lastIndex=0;;){var h=i.exec(t);if(!h)break;var u=h.index;if(n.ignoreHtml){var c=t.slice(Math.max(u-3,0),u);if(c&&a.test(c))continue}var p=u+t.slice(u).search(o),l=t.slice(u,p).replace(s,"");if(!n.ignore||!n.ignore.test(l)){p=u+l.length;var d=e(l,u,p,t);t=t.slice(0,u)+d+t.slice(p),i.lastIndex=u+d.length}}return i.lastIndex=0,t},r.ensureValidHostname=function(e){if(e.match(r.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(t.toASCII(e).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}},r.noConflict=function(t){if(t){var e={URI:this.noConflict()};return i.URITemplate&&"function"==typeof i.URITemplate.noConflict&&(e.URITemplate=i.URITemplate.noConflict()),i.IPv6&&"function"==typeof i.IPv6.noConflict&&(e.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&"function"==typeof i.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=i.SecondLevelDomains.noConflict()),e}return i.URI===this&&(i.URI=m),this},v.build=function(t){return t===!0?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},v.clone=function(){return new r(this)},v.valueOf=v.toString=function(){return this.build(!1)._string},v.protocol=f("protocol"),v.username=f("username"),v.password=f("password"),v.hostname=f("hostname"),v.port=f("port"),v.query=g("query","?"),v.fragment=g("fragment","#"),v.search=function(t,e){var n=this.query(t,e);return"string"==typeof n&&n.length?"?"+n:n},v.hash=function(t,e){var n=this.fragment(t,e);return"string"==typeof n&&n.length?"#"+n:n},v.pathname=function(t,e){if(void 0===t||t===!0){var n=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?r.decodeUrnPath:r.decodePath)(n):n}return this._parts.path=this._parts.urn?t?r.recodeUrnPath(t):"":t?r.recodePath(t):"/",this.build(!e),this},v.path=v.pathname,v.href=function(t,e){var n;if(void 0===t)return this.toString();this._string="",this._parts=r._parts();var i=t instanceof r,o="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName){var s=r.getDomAttribute(t);t=t[s]||"",o=!1}if(!i&&o&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=r.parse(String(t),this._parts);else{if(!i&&!o)throw new TypeError("invalid input");var a=i?t._parts:t;for(n in a)y.call(this._parts,n)&&(this._parts[n]=a[n])}return this.build(!e),this},v.is=function(t){var e=!1,i=!1,o=!1,s=!1,a=!1,h=!1,u=!1,c=!this._parts.urn;switch(this._parts.hostname&&(c=!1,i=r.ip4_expression.test(this._parts.hostname),o=r.ip6_expression.test(this._parts.hostname),e=i||o,s=!e,a=s&&n&&n.has(this._parts.hostname),h=s&&r.idn_expression.test(this._parts.hostname),u=s&&r.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return c;case"absolute":return!c;case"domain":case"name":return s;case"sld":return a;case"ip":return e;case"ip4":case"ipv4":case"inet4":return i;case"ip6":case"ipv6":case"inet6":return o;case"idn":return h;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var k=v.protocol,E=v.port,S=v.hostname;v.protocol=function(t,e){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,""),!t.match(r.protocol_expression)))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return k.call(this,t,e)},v.scheme=v.protocol,v.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(t+="",":"===t.charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return E.call(this,t,e)},v.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var n={},i=r.parseHost(t,n);if("/"!==i)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=n.hostname}return S.call(this,t,e)},v.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var n=this.protocol(),i=this.authority();return i?(n?n+"://":"")+this.authority():""}var o=r(t);return this.protocol(o.protocol()).authority(o.authority()).build(!e),this},v.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?r.buildHost(this._parts):"";var n=r.parseHost(t,this._parts);if("/"!==n)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},v.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?r.buildAuthority(this._parts):"";var n=r.parseAuthority(t,this._parts);if("/"!==n)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},v.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var n=r.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==t[t.length-1]&&(t+="@"),r.parseUserinfo(t,this._parts),this.build(!e),this},v.resource=function(t,e){var n;return void 0===t?this.path()+this.search()+this.hash():(n=r.parse(t),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!e),this)},v.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var i=this._parts.hostname.length-this.domain().length,s=this._parts.hostname.substring(0,i),a=new RegExp("^"+o(s));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&r.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(a,t),this.build(!e),this},v.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var i=this._parts.hostname.length-this.tld(e).length-1;return i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||""}if(!t)throw new TypeError("cannot set domain empty");if(r.ensureValidHostname(t),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var s=new RegExp(o(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!e),this},v.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),r=this._parts.hostname.substring(i+1);return e!==!0&&n&&n.list[r.toLowerCase()]?n.get(this._parts.hostname)||r:r}var s;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');s=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!e),this},v.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return t?r.decodePath(i):i}var s=this._parts.path.length-this.filename().length,a=this._parts.path.substring(0,s),h=new RegExp("^"+o(a));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=r.recodePath(t),this._parts.path=this._parts.path.replace(h,t),this.build(!e),this},v.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(n+1);return t?r.decodePathSegment(i):i}var s=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(s=!0);var a=new RegExp(o(this.filename())+"$");return t=r.recodePath(t),this._parts.path=this._parts.path.replace(a,t),s?this.normalizePath(e):this.build(!e),this},v.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var n,i,s=this.filename(),a=s.lastIndexOf(".");return-1===a?"":(n=s.substring(a+1),i=/^[a-z0-9%]+$/i.test(n)?n:"",t?r.decodePathSegment(i):i)}"."===t.charAt(0)&&(t=t.substring(1));var h,u=this.suffix();if(u)h=t?new RegExp(o(u)+"$"):new RegExp(o("."+u)+"$");else{if(!t)return this;this._parts.path+="."+r.recodePath(t)}return h&&(t=r.recodePath(t),this._parts.path=this._parts.path.replace(h,t)),this.build(!e),this},v.segment=function(t,e,n){var i=this._parts.urn?":":"/",r=this.path(),o="/"===r.substring(0,1),s=r.split(i);if(void 0!==t&&"number"!=typeof t&&(n=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(o&&s.shift(),0>t&&(t=Math.max(s.length+t,0)),void 0===e)return void 0===t?s:s[t];if(null===t||void 0===s[t])if(a(e)){s=[];for(var h=0,u=e.length;u>h;h++)(e[h].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(p(e[h])))}else(e||"string"==typeof e)&&(e=p(e),""===s[s.length-1]?s[s.length-1]=e:s.push(e));else e?s[t]=p(e):s.splice(t,1);return o&&s.unshift(""),this.path(s.join(i),n)},v.segmentCoded=function(t,e,n){var i,o,s;if("number"!=typeof t&&(n=e,e=t,t=void 0),void 0===e){if(i=this.segment(t,e,n),a(i))for(o=0,s=i.length;s>o;o++)i[o]=r.decode(i[o]);else i=void 0!==i?r.decode(i):void 0;return i}if(a(e))for(o=0,s=e.length;s>o;o++)e[o]=r.encode(e[o]);else e="string"==typeof e||e instanceof String?r.encode(e):e;return this.segment(t,e,n)};var T=v.query;return v.query=function(t,e){if(t===!0)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),i=t.call(this,n);return this._parts.query=r.buildQuery(i||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=r.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):T.call(this,t,e)},v.setQuery=function(t,e,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)i[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in t)y.call(t,o)&&(i[o]=t[o])}return this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},v.addQuery=function(t,e,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(i,t,void 0===e?null:e),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},v.removeQuery=function(t,e,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(i,t,e),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},v.hasQuery=function(t,e,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(i,t,e,n)},v.setSearch=v.setQuery,v.addSearch=v.addQuery,v.removeSearch=v.removeQuery,v.hasSearch=v.hasQuery,v.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},v.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},v.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},v.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},v.normalizePath=function(t){var e=this._parts.path;if(!e)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;e=r.recodePath(e);var n,i,o,s="";for("/"!==e.charAt(0)&&(n=!0,e="/"+e),("/.."===e.slice(-3)||"/."===e.slice(-2))&&(e+="/"),e=e.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),n&&(s=e.substring(1).match(/^(\.\.\/)+/)||"",s&&(s=s[0]));;){if(i=e.search(/\/\.\.(\/|$)/),-1===i)break;0!==i?(o=e.substring(0,i).lastIndexOf("/"),-1===o&&(o=i),e=e.substring(0,o)+e.substring(i+3)):e=e.substring(3)}return n&&this.is("relative")&&(e=s+e.substring(1)),this._parts.path=e,this.build(!t),this},v.normalizePathname=v.normalizePath,v.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},v.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},v.normalizeSearch=v.normalizeQuery,v.normalizeHash=v.normalizeFragment,v.iso8859=function(){var t=r.encode,e=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=t,r.decode=e}return this},v.unicode=function(){var t=r.encode,e=r.decode;r.encode=d,r.decode=unescape;try{this.normalize()}finally{r.encode=t,r.decode=e}return this},v.readable=function(){var e=this.clone();e.username("").password("").normalize();var n="";if(e._parts.protocol&&(n+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(n+=t.toUnicode(e._parts.hostname),e._parts.port&&(n+=":"+e._parts.port)):n+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(n+="/"),n+=e.path(!0),e._parts.query){for(var i="",o=0,s=e._parts.query.split("&"),a=s.length;a>o;o++){var h=(s[o]||"").split("=");i+="&"+r.decodeQuery(h[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==h[1]&&(i+="="+r.decodeQuery(h[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=r.decodeQuery(e.hash(),!0)},v.absoluteTo=function(t){var e,n,i,o=this.clone(),s=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof r||(t=new r(t)),o._parts.protocol||(o._parts.protocol=t._parts.protocol),this._parts.hostname)return o;for(n=0;i=s[n];n++)o._parts[i]=t._parts[i];return o._parts.path?".."===o._parts.path.substring(-2)&&(o._parts.path+="/"):(o._parts.path=t._parts.path,o._parts.query||(o._parts.query=t._parts.query)),"/"!==o.path().charAt(0)&&(e=t.directory(),e=e?e:0===t.path().indexOf("/")?"/":"",o._parts.path=(e?e+"/":"")+o._parts.path,o.normalizePath()),o.build(),o},v.relativeTo=function(t){var e,n,i,o,s,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new r(t).normalize(),e=a._parts,n=t._parts,o=a.path(),s=t.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==s.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===n.protocol&&(e.protocol=null),e.username!==n.username||e.password!==n.password)return a.build();if(null!==e.protocol||null!==e.username||null!==e.password)return a.build();if(e.hostname!==n.hostname||e.port!==n.port)return a.build();if(e.hostname=null,e.port=null,o===s)return e.path="",a.build();if(i=r.commonPath(o,s),!i)return a.build();var h=n.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=h+e.path.substring(i.length)||"./",a.build()},v.equals=function(t){var e,n,i,o=this.clone(),s=new r(t),h={},u={},p={};if(o.normalize(),s.normalize(),o.toString()===s.toString())return!0;if(e=o.query(),n=s.query(),o.query(""),s.query(""),o.toString()!==s.toString())return!1;if(e.length!==n.length)return!1;h=r.parseQuery(e,this._parts.escapeQuerySpace),u=r.parseQuery(n,this._parts.escapeQuerySpace);for(i in h)if(y.call(h,i)){if(a(h[i])){if(!c(h[i],u[i]))return!1}else if(h[i]!==u[i])return!1;p[i]=!0}for(i in u)if(y.call(u,i)&&!p[i])return!1;return!0},v.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},v.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},r})},{"./IPv6":4,"./SecondLevelDomains":5,"./punycode":7}],7:[function(e,n,i){(function(e){!function(r){function o(t){throw new RangeError(j[t])}function s(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function a(t,e){var n=t.split("@"),i="";n.length>1&&(i=n[0]+"@",t=n[1]),t=t.replace(P,".");var r=t.split("."),o=s(r,e).join(".");return i+o}function h(t){for(var e,n,i=[],r=0,o=t.length;o>r;)e=t.charCodeAt(r++),e>=55296&&56319>=e&&o>r?(n=t.charCodeAt(r++),56320==(64512&n)?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--)):i.push(e);return i}function u(t){return s(t,function(t){var e="";return t>65535&&(t-=65536,e+=I(t>>>10&1023|55296),t=56320|1023&t),e+=I(t)}).join("")}function c(t){return 10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:k}function p(t,e){return t+22+75*(26>t)-((0!=e)<<5)}function l(t,e,n){var i=0;for(t=n?L(t/C):t>>1,t+=L(t/e);t>O*S>>1;i+=k)t=L(t/O);return L(i+(O+1)*t/(t+T))}function d(t){var e,n,i,r,s,a,h,p,d,f,g=[],m=t.length,v=0,y=z,b=N;for(n=t.lastIndexOf(q),0>n&&(n=0),i=0;n>i;++i)t.charCodeAt(i)>=128&&o("not-basic"),g.push(t.charCodeAt(i));for(r=n>0?n+1:0;m>r;){for(s=v,a=1,h=k;r>=m&&o("invalid-input"),p=c(t.charCodeAt(r++)),(p>=k||p>L((_-v)/a))&&o("overflow"),v+=p*a,d=b>=h?E:h>=b+S?S:h-b,!(d>p);h+=k)f=k-d,a>L(_/f)&&o("overflow"),a*=f;e=g.length+1,b=l(v-s,e,0==s),L(v/e)>_-y&&o("overflow"),y+=L(v/e),v%=e,g.splice(v++,0,y)}return u(g)}function f(t){var e,n,i,r,s,a,u,c,d,f,g,m,v,y,b,w=[];for(t=h(t),m=t.length,e=z,n=0,s=N,a=0;m>a;++a)g=t[a],128>g&&w.push(I(g));for(i=r=w.length,r&&w.push(q);m>i;){for(u=_,a=0;m>a;++a)g=t[a],g>=e&&u>g&&(u=g);for(v=i+1,u-e>L((_-n)/v)&&o("overflow"),n+=(u-e)*v,e=u,a=0;m>a;++a)if(g=t[a],e>g&&++n>_&&o("overflow"),g==e){for(c=n,d=k;f=s>=d?E:d>=s+S?S:d-s,!(f>c);d+=k)b=c-f,y=k-f,w.push(I(p(f+b%y,0))),c=L(b/y);w.push(I(p(c,0))),s=l(n,v,i==r),n=0,++i}++n,++e}return w.join("")}function g(t){return a(t,function(t){return A.test(t)?d(t.slice(4).toLowerCase()):t})}function m(t){return a(t,function(t){return R.test(t)?"xn--"+f(t):t})}var v="object"==typeof i&&i&&!i.nodeType&&i,y="object"==typeof n&&n&&!n.nodeType&&n,b="object"==typeof e&&e;(b.global===b||b.window===b||b.self===b)&&(r=b);var w,x,_=2147483647,k=36,E=1,S=26,T=38,C=700,N=72,z=128,q="-",A=/^xn--/,R=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,j={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=k-E,L=Math.floor,I=String.fromCharCode;if(w={version:"1.3.2",ucs2:{decode:h,encode:u},decode:d,encode:f,toASCII:m,toUnicode:g},"function"==typeof t&&"object"==typeof t.amd&&t.amd)t("punycode",function(){return w});else if(v&&y)if(n.exports==v)y.exports=w;else for(x in w)w.hasOwnProperty(x)&&(v[x]=w[x]);else r.punycode=w}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(t,e){function n(t){this.opening=new i.defer,this.opened=this.opening.promise,this.isOpen=!1,this.url=void 0,this.loading={manifest:new i.defer,spine:new i.defer,metadata:new i.defer,cover:new i.defer,navigation:new i.defer,pageList:new i.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise},this.ready=i.hash(this.loaded),this.isRendered=!1,this.request=this.requestMethod.bind(this),this.spine=new o(this.request),this.locations=new s(this.spine,this.request),t&&this.open(t)}var i=t("rsvp"),r=t("urijs"),o=(t("./core"),t("./spine")),s=t("./locations"),a=t("./parser"),h=t("./navigation"),u=(t("./rendition"),t("./continuous"),t("./paginate"),t("./unarchive")),c=t("./request"),p=t("./epubcfi");n.prototype.open=function(t){var e,n,i,o=new a,s=this,h="META-INF/container.xml";return t?(e=r(t),this.url=t,"opf"===e.suffix()?(this.packageUrl=t,this.containerUrl="",this.baseUrl=e.origin()?e.origin()+"/"+e.directory()+"/":window?e.absoluteTo(window.location.href).directory()+"/":e.directory()+"/",n=this.request(this.packageUrl)):this.isArchivedUrl(e)?(this.url="/",this.containerUrl=r(h).absoluteTo(this.url).toString(),i=this.unarchive(t).then(function(){return this.request(this.containerUrl)}.bind(this))):e.suffix()||(this.containerUrl=this.url+h,i=this.request(this.containerUrl).catch(function(t){s.opening.reject(t)})),i&&(n=i.then(function(t){return o.container(t)}).then(function(t){var n=r(t.packagePath),i=n.absoluteTo(s.url);return s.packageUrl=i.toString(),s.encoding=t.encoding,s.baseUrl=n.origin()?n.origin()+"/"+n.directory()+"/":window&&!s.isArchivedUrl(e)?i.absoluteTo(window.location.href).directory()+"/":"/"+n.directory()+"/",s.request(s.packageUrl)}).catch(function(t){console.error("Could not load book at: "+(this.packageUrl||this.containerPath)),s.trigger("book:loadFailed",this.packageUrl||this.containerPath),s.opening.reject(t)})),n.then(function(t){s.unpack(t),s.loading.manifest.resolve(s.package.manifest),s.loading.metadata.resolve(s.package.metadata),s.loading.spine.resolve(s.spine),s.loading.cover.resolve(s.cover),s.isOpen=!0,s.opening.resolve(s)}).catch(function(t){console.error(t.message,t.stack),s.opening.reject(t)}),this.opened):(this.opening.resolve(this),this.opened)},n.prototype.unpack=function(t){var e=this,n=new a;e.package=n.packageContents(t),e.package&&(e.package.baseUrl=e.baseUrl,this.spine.load(e.package),e.navigation=new h(e.package,this.request),e.navigation.load().then(function(t){e.toc=t,e.loading.navigation.resolve(e.toc)}),e.cover=r(e.package.coverPath).absoluteTo(e.baseUrl).toString())},n.prototype.section=function(t){return this.spine.get(t)},n.prototype.renderTo=function(e,n){var i=n&&n.method?n.method:"rendition",r=t("./"+i);return this.rendition=new r(this,n),this.rendition.attachTo(e),this.rendition},n.prototype.requestMethod=function(t){return this.archive?this.archive.request(t):c(t,null,this.requestCredentials,this.requestHeaders)},n.prototype.setRequestCredentials=function(t){this.requestCredentials=t},n.prototype.setRequestHeaders=function(t){this.requestHeaders=t},n.prototype.unarchive=function(t){return this.archive=new u,this.archive.open(t)},n.prototype.isArchivedUrl=function(t){var e,n;return t instanceof ArrayBuffer?!0:(e=r(t),n=e.suffix(),!n||"epub"!=n&&"zip"!=n?!1:!0)},n.prototype.coverUrl=function(){var t=this.loaded.cover.then(function(){return this.archive?this.archive.createUrl(this.cover):this.cover}.bind(this));return t},n.prototype.range=function(t){var e=new p(t),n=this.spine.get(e.spinePos);return n.load().then(function(){var t=e.toRange(n.document);return t})},e.exports=n,i.EventTarget.mixin(n.prototype),i.configure("instrument",!0)},{"./continuous":9,"./core":10,"./epubcfi":11,"./locations":15,"./navigation":17,"./paginate":18,"./parser":19,"./rendition":21,"./request":23,"./spine":25,"./unarchive":26,rsvp:3,urijs:6}],9:[function(t,e){function n(t,e){o.apply(this,arguments),this.settings=r.extend(this.settings||{},{infinite:!0,overflow:"auto",axis:"vertical",offset:500,offsetDelta:250}),r.extend(this.settings,e),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}{var i=t("rsvp"),r=t("./core"),o=t("./rendition");t("./view")}n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.attachListeners=function(){r.isNumber(this.settings.width)&&r.isNumber(this.settings.height)||window.addEventListener("resize",this.onResized.bind(this),!1),this.settings.infinite&&this.start()},n.prototype.parseTarget=function(t){this.epubcfi.isCfiString(t)?(cfi=new EpubCFI(t),spinePos=cfi.spinePos,section=this.book.spine.get(spinePos)):section=this.book.spine.get(t)},n.prototype.moveTo=function(t){return this.check(t.left+this.settings.offset,t.top+this.settings.offset).then(function(){"vertical"===this.settings.axis?this.scrollBy(0,t.top):this.scrollBy(t.left,0)}.bind(this))},n.prototype.afterDisplayed=function(t){var e,n,i=t.section.next(),r=t.section.prev(),o=this.views.indexOf(t);o+1===this.views.length&&i&&(n=this.createView(i),this.q.enqueue(this.append,n)),0===o&&r&&(e=this.createView(r,this.viewSettings),this.q.enqueue(this.prepend,e)),this.trigger("added",t.section)},n.prototype.removeShownListeners=function(t){t.onDisplayed=function(){}},n.prototype.append=function(t){return t.onDisplayed=this.afterDisplayed.bind(this),this.views.append(t),this.check()},n.prototype.prepend=function(t){return t.onDisplayed=this.afterDisplayed.bind(this),t.on("resized",this.counter.bind(this)),this.views.prepend(t),this.check()},n.prototype.counter=function(t){"vertical"===this.settings.axis?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)},n.prototype.check=function(t){var e=new i.defer,n=this.bounds(),r=[],o=t||this.settings.offset;return this.views.each(function(t){var e=this.isVisible(t,o,o,n);e?t.displayed||t.rendering||r.push(this.render(t)):t.displayed&&(this.q.enqueue(t.destroy.bind(t)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim)}.bind(this),250))}.bind(this)),r.length?i.all(r).then(function(){this.q.enqueue(this.check)
}.bind(this)):(e.resolve(),e.promise)},n.prototype.trim=function(){for(var t=new i.defer,e=this.views.displayed(),n=e[0],r=e[e.length-1],o=this.views.indexOf(n),s=this.views.indexOf(r),a=this.views.slice(0,o),h=this.views.slice(s+1),u=0;u<a.length-1;u++)this.erase(a[u],a);for(var c=1;c<h.length;c++)this.erase(h[c]);return t.resolve(),t.promise},n.prototype.erase=function(t,e){var n,i;this.settings.height?(n=this.container.scrollTop,i=this.container.scrollLeft):(n=window.scrollY,i=window.scrollX);var r=t.bounds();this.views.remove(t),e&&("vertical"===this.settings.axis?this.scrollTo(0,n-r.height,!0):this.scrollTo(i-r.width,0,!0))},n.prototype.start=function(){var t;this.tick=r.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,t=this.settings.height?this.container:window,window.addEventListener("scroll",function(){this.ignore?this.ignore=!1:this.scrolled=!0}.bind(this)),window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this)),this.tick.call(window,this.onScroll.bind(this)),this.scrolled=!1},n.prototype.onScroll=function(){this.scrolled&&(this.settings.height?(scrollTop=this.container.scrollTop,scrollLeft=this.container.scrollLeft):(scrollTop=window.scrollY,scrollLeft=window.scrollX),this.ignore?this.ignore=!1:(0===this.scrollDeltaVert&&0===this.scrollDeltaHorz||this.scrollDeltaVert>this.settings.offsetDelta||this.scrollDeltaHorz>this.settings.offsetDelta)&&(this.q.enqueue(this.check),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.trigger("scroll",{top:scrollTop,left:scrollLeft})),this.scrollDeltaVert+=Math.abs(scrollTop-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(scrollLeft-this.prevScrollLeft),this.prevScrollTop=scrollTop,this.prevScrollLeft=scrollLeft,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.scrolled=!1),this.tick.call(window,this.onScroll.bind(this))},n.prototype.resizeView=function(t){"horizontal"===this.settings.axis?t.lock("height",this.stage.width,this.stage.height):t.lock("width",this.stage.width,this.stage.height)},n.prototype.currentLocation=function(){{var t,e,n=this.visible();this.container.getBoundingClientRect()}return 1===n.length?this.map.page(n[0]):n.length>1?(t=this.map.page(n[0]),e=this.map.page(n[n.length-1]),{start:t.start,end:e.end}):void 0},e.exports=n},{"./core":10,"./rendition":21,"./view":27,rsvp:3}],10:[function(t,e){function n(t){return!(!t||1!=t.nodeType)}function i(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return e}function r(t){for(var e=-1,n=Object.keys(t),i=n.length,r=Array(i);++e<i;)r[e]=t[n[e]];return r}function o(t,e){var n,i=[],r=[],o=uri(t),s=uri(e),a=o.directory,h=s.directory,u=[];return"/"===a[0]&&(a=a.substring(1)),"/"===h[h.length-1]&&(a=a.substring(0,a.length-1)),"/"===h[0]&&(h=h.substring(1)),"/"===h[h.length-1]&&(h=h.substring(0,h.length-1)),a&&(u=a.split("/")),n=h.split("/"),n.reverse().forEach(function(t){".."===t?u.pop():t===u[u.length-1]?(u.pop(),r.unshift(t)):r.unshift(t)}),i=[o.origin],u.length&&(i=i.concat(u)),r&&(i=i.concat(r)),i=i.concat(s.filename),i.join("/")}function s(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function a(t){return!isNaN(parseFloat(t))&&isFinite(t)}function h(t){var e=["Webkit","Moz","O","ms"],n=t[0].toUpperCase()+t.slice(1),i=e.length;if("undefined"!=typeof document.body.style[t])return t;for(var r=0;i>r;r++)if("undefined"!=typeof document.body.style[e[r]+n])return e[r]+n;return t}function u(t){for(var e=1,n=arguments.length;n>e;e++){var i=arguments[e];for(var r in i)void 0===t[r]&&(t[r]=i[r])}return t}function c(t){var e=[].slice.call(arguments,1);return e.forEach(function(e){e&&Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}),t}function p(t,e,n){var i=l(t,e,n);return e.splice(i,0,t),i}function l(t,e,n,i,r){var o,s=i||0,a=r||e.length,h=parseInt(s+(a-s)/2);return n||(n=function(t,e){return t>e?1:e>t?-1:(t=e)?0:void 0}),0>=a-s?h:(o=n(e[h],t),a-s===1?o>0?h:h+1:0===o?h:-1===o?l(t,e,n,h,a):l(t,e,n,s,h))}function d(t,e,n,i,r){var o,s=i||0,a=r||e.length,h=parseInt(s+(a-s)/2);return n||(n=function(t,e){return t>e?1:e>t?-1:(t=e)?0:void 0}),0>=a-s?-1:(o=n(e[h],t),a-s===1?0===o?h:-1:0===o?h:-1===o?d(t,e,n,h,a):d(t,e,n,s,h))}function f(t){var e=window.getComputedStyle(t),n=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],r=0,o=0;return n.forEach(function(t){r+=parseFloat(e[t])||0}),i.forEach(function(t){o+=parseFloat(e[t])||0}),{height:o,width:r}}function g(t){var e=window.getComputedStyle(t),n=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],r=0,o=0;return n.forEach(function(t){r+=parseFloat(e[t])||0}),i.forEach(function(t){o+=parseFloat(e[t])||0}),{height:o,width:r}}function m(){var t=window.innerWidth,e=window.innerHeight;return{top:0,left:0,right:t,bottom:e,width:t,height:e}}function v(t){var e=t.match(/[^'"]+|['"]/g);return e=e.map(function(t){return"'"===t?'"\'"':'"'===t?"'\"'":"'"+t+"'"}),"concat('',"+e.join(",")+")"}function y(t){for(var e,n=t.parentNode,i=n.childNodes,r=-1,o=0;o<i.length&&(e=i[o],e.nodeType===Node.TEXT_NODE&&r++,e!=t);o++);return r}function b(t){return["xml","opf","ncx"].indexOf(t)>-1}function w(t,e){var n,i=window.URL||window.webkitURL||window.mozURL,r=new Blob([t],{type:e});return n=i.createObjectURL(r)}function x(t){return Object.prototype.toString.call(t).slice(8,-1)}var _=(t("rsvp"),"undefined"!=typeof window?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:!1);e.exports={isElement:n,uuid:i,values:r,resolveUrl:o,indexOfSorted:d,documentHeight:s,isNumber:a,prefixed:h,defaults:u,extend:c,insert:p,locationOf:l,indexOfSorted:d,requestAnimationFrame:_,bounds:f,borders:g,windowBounds:m,cleanStringForXpath:v,indexOfTextNode:y,isXml:b,createBlobUrl:w,type:x}},{rsvp:3}],11:[function(t,e){function n(t,e,r){var o;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof n))return new n(t,e,r);if("string"==typeof e?this.base=this.parseComponent(e):"object"==typeof e&&e.steps&&(this.base=e),o=this.checkType(t),"string"===o)return this.str=t,i.extend(this,this.parse(t));if("range"===o)return i.extend(this,this.fromRange(t,this.base,r));if("node"===o)return i.extend(this,this.fromNode(t,this.base,r));if("EpubCFI"===o&&t.path)return t;if(t)throw new TypeError("not a valid argument for EpubCFI");return this}var i=(t("urijs"),t("./core"));n.prototype.checkType=function(t){return this.isCfiString(t)?"string":"object"==typeof t&&"Range"===i.type(t)?"range":"object"==typeof t&&t instanceof window.Node?"node":"object"==typeof t&&t instanceof n?"EpubCFI":!1},n.prototype.parse=function(t){var e,n,i,r={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return"string"!=typeof t?{spinePos:-1}:(0===t.indexOf("epubcfi(")&&")"===t[t.length-1]&&(t=t.slice(8,t.length-1)),(e=this.getChapterComponent(t))?(r.base=this.parseComponent(e),n=this.getPathComponent(t),r.path=this.parseComponent(n),i=this.getRange(t),i&&(r.range=!0,r.start=this.parseComponent(i[0]),r.end=this.parseComponent(i[1])),r.spinePos=r.base.steps[1].index,r):{spinePos:-1})},n.prototype.parseComponent=function(t){var e,n={steps:[],terminal:{offset:null,assertion:null}},i=t.split(":"),r=i[0].split("/");return i.length>1&&(e=i[1],n.terminal=this.parseTerminal(e)),""===r[0]&&r.shift(),n.steps=r.map(function(t){return this.parseStep(t)}.bind(this)),n},n.prototype.parseStep=function(t){var e,n,i,r,o;return r=t.match(/\[(.*)\]/),r&&r[1]&&(o=r[1]),n=parseInt(t),isNaN(n)?void 0:(n%2===0?(e="element",i=n/2-1):(e="text",i=(n-1)/2),{type:e,index:i,id:o||null})},n.prototype.parseTerminal=function(t){var e,n,i=t.match(/\[(.*)\]/);return i&&i[1]?(e=parseInt(t.split("[")[0])||null,n=i[1]):e=parseInt(t)||null,{offset:e,assertion:n}},n.prototype.getChapterComponent=function(t){var e=t.split("!");return e[0]},n.prototype.getPathComponent=function(t){var e=t.split("!");return e[1]?(ranges=e[1].split(","),ranges[0]):void 0},n.prototype.getRange=function(t){var e=t.split(",");return 3===e.length?[e[1],e[2]]:!1},n.prototype.getCharecterOffsetComponent=function(t){var e=t.split(":");return e[1]||""},n.prototype.joinSteps=function(t){return t.map(function(t){var e="";return"element"===t.type&&(e+=2*(t.index+1)),"text"===t.type&&(e+=1+2*t.index),t.id&&(e+="["+t.id+"]"),e}).join("/")},n.prototype.segmentString=function(t){var e="/";return e+=this.joinSteps(t.steps),t.terminal&&null!=t.terminal.offset&&(e+=":"+t.terminal.offset),t.terminal&&null!=t.terminal.assertion&&(e+="["+t.terminal.assertion+"]"),e},n.prototype.toString=function(){var t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.start&&(t+=",",t+=this.segmentString(this.start)),this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")"},n.prototype.compare=function(t,e){if("string"==typeof t&&(t=new n(t)),"string"==typeof e&&(e=new n(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;for(var i=0;i<t.path.steps.length;i++){if(!e.path.steps[i])return 1;if(t.path.steps[i].index>e.path.steps[i].index)return 1;if(t.path.steps[i].index<e.path.steps[i].index)return-1}return t.path.steps.length<e.path.steps.length?1:t.path.terminal.offset>e.path.terminal.offset?1:t.path.terminal.offset<e.path.terminal.offset?-1:0},n.prototype.step=function(t){var e=t.nodeType===Node.TEXT_NODE?"text":"element";return{id:t.id,tagName:t.tagName,type:e,index:this.position(t)}},n.prototype.filteredStep=function(t,e){var n,i=this.filter(t,e);return i?(n=i.nodeType===Node.TEXT_NODE?"text":"element",{id:i.id,tagName:i.tagName,type:n,index:this.filteredPosition(i,e)}):void 0},n.prototype.pathTo=function(t,e,n){for(var i,r={steps:[],terminal:{offset:null,assertion:null}},o=t;o&&o.parentNode&&o.parentNode.nodeType!=Node.DOCUMENT_NODE;)i=n?this.filteredStep(o,n):this.step(o),i&&r.steps.unshift(i),o=o.parentNode;return null!=e&&e>=0&&(r.terminal.offset=e,"text"!=r.steps[r.steps.length-1].type&&r.steps.push({type:"text",index:0})),r},n.prototype.equalStep=function(t,e){return t&&e?t.index===e.index&&t.id===e.id&&t.type===e.type?!0:!1:!1},n.prototype.fromRange=function(t,e,n){var i={range:!1,base:{},path:{},start:null,end:null},r=t.startContainer,o=t.endContainer,s=t.startOffset,a=t.endOffset,h=!1;if(n&&(h=null!=r.ownerDocument.querySelector("."+n)),"string"==typeof e?(i.base=this.parseComponent(e),i.spinePos=i.base.steps[1].index):"object"==typeof e&&(i.base=e),t.collapsed)h&&(s=this.patchOffset(r,s,n)),i.path=this.pathTo(r,s,n);else{i.range=!0,h&&(s=this.patchOffset(r,s,n)),i.start=this.pathTo(r,s,n),h&&(a=this.patchOffset(o,a,n)),i.end=this.pathTo(o,a,n),i.path={steps:[],terminal:null};var u,c=i.start.steps.length;for(u=0;c>u&&this.equalStep(i.start.steps[u],i.end.steps[u]);u++)u==c-1?i.start.terminal===i.end.terminal&&(i.path.steps.push(i.start.steps[u]),i.range=!1):i.path.steps.push(i.start.steps[u]);i.start.steps=i.start.steps.slice(i.path.steps.length),i.end.steps=i.end.steps.slice(i.path.steps.length)}return i},n.prototype.fromNode=function(t,e,n){var i={range:!1,base:{},path:{},start:null,end:null},r=!1;return n&&(r=null!=t.ownerDocument.querySelector("."+n)),"string"==typeof e?(i.base=this.parseComponent(e),i.spinePos=i.base.steps[1].index):"object"==typeof e&&(i.base=e),i.path=this.pathTo(t,null,n),i},n.prototype.filter=function(t,e){var n,i,r,o,s=!1;return t.nodeType===Node.TEXT_NODE?(s=!0,r=t.parentNode,n=t.parentNode.classList.contains(e)):(s=!1,n=t.classList.contains(e)),n&&s?(previousSibling=r.previousSibling,o=r.nextSibling,previousSibling&&previousSibling.nodeType===Node.TEXT_NODE?i=previousSibling:o&&o.nodeType===Node.TEXT_NODE&&(i=o),i?i:t):n&&!s?!1:t},n.prototype.patchOffset=function(t,e,n){if(t.nodeType!=Node.TEXT_NODE)return console.error("Anchor must be a text node"),void 0;var i=t,r=e;for(t.parentNode.classList.contains(n)&&(i=t.parentNode);i.previousSibling;){if(i.previousSibling.nodeType===Node.ELEMENT_NODE){if(!i.previousSibling.classList.contains(n))break;r+=i.previousSibling.textContent.length}else r+=i.previousSibling.textContent.length;i=i.previousSibling}return r},n.prototype.normalizedMap=function(t,e,n){var i,r,o,s={},a=-1,h=t.length;for(i=0;h>i;i++)r=t[i].nodeType,r===Node.ELEMENT_NODE&&t[i].classList.contains(n)&&(r=Node.TEXT_NODE),i>0&&r===Node.TEXT_NODE&&o===Node.TEXT_NODE?s[i]=a:e===r&&(a+=1,s[i]=a),o=r;return s},n.prototype.position=function(t){var e,n;return t.nodeType===Node.ELEMENT_NODE?(e=t.parentNode.children,n=Array.prototype.indexOf.call(e,t)):(e=this.textNodes(t.parentNode),n=e.indexOf(t)),n},n.prototype.filteredPosition=function(t,e){var n,i,r;return t.nodeType===Node.ELEMENT_NODE?(n=t.parentNode.children,r=this.normalizedMap(n,Node.ELEMENT_NODE,e)):(n=t.parentNode.childNodes,t.parentNode.classList.contains(e)&&(t=t.parentNode,n=t.parentNode.childNodes),r=this.normalizedMap(n,Node.TEXT_NODE,e)),i=Array.prototype.indexOf.call(n,t),r[i]},n.prototype.stepsToXpath=function(t){var e=[".","*"];return t.forEach(function(t){var n=t.index+1;t.id?e.push("*[position()="+n+" and @id='"+t.id+"']"):"text"===t.type?e.push("text()["+n+"]"):e.push("*["+n+"]")}),e.join("/")},n.prototype.stepsToQuerySelector=function(t){var e=["html"];return t.forEach(function(t){var n=t.index+1;t.id?e.push("#"+t.id):"text"===t.type||e.push("*:nth-child("+n+")")}),e.join(">")},n.prototype.textNodes=function(t,e){return Array.prototype.slice.call(t.childNodes).filter(function(t){return t.nodeType===Node.TEXT_NODE?!0:e&&t.classList.contains(e)?!0:!1})},n.prototype.walkToNode=function(t,e,n){var i,r,o=e||document,s=o.documentElement,a=t.length;for(r=0;a>r;r++)i=t[r],"element"===i.type?s=s.children[i.index]:"text"===i.type&&(s=this.textNodes(s,n)[i.index]);return s},n.prototype.findNode=function(t,e,n){var i,r,o=e||document;return n||"undefined"==typeof o.evaluate?i=n?this.walkToNode(t,o,n):this.walkToNode(t,o):(r=this.stepsToXpath(t),i=o.evaluate(r,o,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),i},n.prototype.fixMiss=function(t,e,n,i){var r,o,s,a=this.findNode(t.slice(0,-1),n,i),h=a.childNodes,u=this.normalizedMap(h,Node.TEXT_NODE,i),c=t[t.length-1].index;for(var s in u){if(!u.hasOwnProperty(s))return;if(u[s]===c){if(r=h[s],o=r.textContent.length,!(e>o)){a=r.nodeType===Node.ELEMENT_NODE?r.childNodes[0]:r;break}e-=o}}return{container:a,offset:e}},n.prototype.toRange=function(t,e){var n,i,r,o,s,a,h,u=t||document,c=u.createRange(),p=this,l=e?null!=u.querySelector("."+e):!1;if(p.range?(n=p.start,s=p.path.steps.concat(n.steps),r=this.findNode(s,u,l?e:null),i=p.end,a=p.path.steps.concat(i.steps),o=this.findNode(a,u,l?e:null)):(n=p.path,s=p.path.steps,r=this.findNode(p.path.steps,u,l?e:null)),!r)return null;try{null!=n.terminal.offset?c.setStart(r,n.terminal.offset):c.setStart(r,0)}catch(d){h=this.fixMiss(s,n.terminal.offset,u,l?e:null),c.setStart(h.container,h.offset)}if(o)try{null!=i.terminal.offset?c.setEnd(o,i.terminal.offset):c.setEnd(o,0)}catch(d){h=this.fixMiss(a,p.end.terminal.offset,u,l?e:null),c.setEnd(h.container,h.offset)}return c},n.prototype.isCfiString=function(t){return"string"==typeof t&&0===t.indexOf("epubcfi(")&&")"===t[t.length-1]?!0:!1},n.prototype.generateChapterComponent=function(t,e,n){var i=parseInt(e),r=t+1,o="/"+r+"/";return o+=2*(i+1),n&&(o+="["+n+"]"),o},e.exports=n},{"./core":10,urijs:6}],12:[function(t,e){function n(t){this.className=t||"annotator-hl"}n.prototype.add=function(t,e){var n=[];return t&&t.startContainer||console.error("Not a valid Range"),e&&(this.className=e),this.doc=t.startContainer.ownerDocument,this.getTextNodes(t,this.doc).forEach(function(t){n.push(this.wrapNode(t))}.bind(this)),t.startContainer===t.endContainer?n.push(this.wrapRange(t)):(n.push(this.wrapPartial(t,t.startContainer,"start")),n.push(this.wrapPartial(t,t.endContainer,"end"))),n},n.prototype.remove=function(){},n.prototype.rejectEmpty=function(t){return t.data.match(/^\s+$/)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},n.prototype.getTextNodes=function(t,e){for(var n,i=e||document,r=i.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_TEXT,this.rejectEmpty),o=!1,s=[];n=r.nextNode();)if(n!=t.startContainer){if(n===t.endContainer)break;o&&s.push(n)}else o=!0;return s},n.prototype.wrapRange=function(t){var e=this.wrapperNode();return t.surroundContents(e),e},n.prototype.wrapNode=function(t){var e=this.wrapperNode(),n=this.doc.createRange();return n.selectNodeContents(t),n.surroundContents(e),e},n.prototype.wrapPartial=function(t,e,n){var i="start"===n?t.startOffset:0,r="start"===n?e.length:t.endOffset,t=this.doc.createRange(),o=this.wrapperNode();return t.setStart(e,i),t.setEnd(e,r),t.surroundContents(o),o},n.prototype.wrapperNode=function(t){void 0===t&&(t="span");var e=document.createElement(t);return e.classList.add(this.className),e},e.exports=n},{}],13:[function(t,e){function n(t){this.context=t||this,this.hooks=[]}var i=t("rsvp");n.prototype.register=function(){for(var t=0;t<arguments.length;++t)if("function"==typeof arguments[t])this.hooks.push(arguments[t]);else for(var e=0;e<arguments[t].length;++e)this.hooks.push(arguments[t][e])},n.prototype.trigger=function(){var t=arguments,e=this.context,n=[];return this.hooks.forEach(function(i){var r=i.apply(e,t);r&&"function"==typeof r.then&&n.push(r)}),i.all(n)},n.prototype.list=function(){return this.hooks},e.exports=n},{rsvp:3}],14:[function(t,e){function n(){}function i(){}function r(){}var o=t("./core");n.prototype.calculate=function(t,e,n,i){var r,s,a,h=i||1,u=Math.floor(t),c=u%2===0?u:u-1,p=Math.floor(c/8),l=n>=0?n:p%2===0?p:p-1;r=h>1?Math.floor((c-l)/h):c,s=r*h,a=(r+l)*h,this.columnAxis=o.prefixed("columnAxis"),this.columnGap=o.prefixed("columnGap"),this.columnWidth=o.prefixed("columnWidth"),this.columnFill=o.prefixed("columnFill"),this.width=c,this.height=e,this.spread=s,this.delta=a,this.column=r,this.gap=l,this.divisor=h},n.prototype.format=function(t){var e=t.document.documentElement,n=t.document.body;e.style.overflow="hidden",e.style.width=this.width+"px",n.style.height=this.height+"px",n.style[this.columnAxis]="horizontal",n.style[this.columnFill]="auto",n.style[this.columnGap]=this.gap+"px",n.style[this.columnWidth]=this.column+"px",t.iframe.style.marginRight=this.gap+"px"},n.prototype.count=function(t){var e=t.root().scrollWidth,n=Math.ceil(e/this.spread);return{spreads:n,pages:n*this.divisor}},i.prototype.calculate=function(){},i.prototype.format=function(t){var e,n,i=t.document.documentElement,r=documentElement.querySelector("[name=viewport");r&&r.hasAttribute("content")&&(content=r.getAttribute("content"),contents=content.split(","),contents[0]&&(e=contents[0].replace("width=","")),contents[1]&&(n=contents[1].replace("height=",""))),t.resize(e,n),i.style.overflow="auto"},i.prototype.count=function(){return{spreads:1,pages:1}},r.prototype.calculate=function(t){this.spread=t,this.column=t,this.gap=0},r.prototype.format=function(t){var e=t.document.documentElement;e.style.width="auto",e.style.height="auto"},r.prototype.count=function(){return{spreads:1,pages:1}},e.exports={Reflowable:n,Fixed:i,Scroll:r}},{"./core":10}],15:[function(t,e){function n(t,e){this.spine=t,this.request=e,this.q=new r(this),this.epubcfi=new o,this._locations=[],this.total=0,this.break=150,this._current=0}var i=t("./core"),r=t("./queue"),o=t("./epubcfi"),s=t("rsvp");n.prototype.generate=function(t){return t&&(this.break=t),this.q.pause(),this.spine.each(function(t){this.q.enqueue(this.process,t)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))},n.prototype.process=function(t){return t.load(this.request).then(function(e){var n,i=e.ownerDocument,r=0;this.sprint(e,function(e){var o,s=e.length,a=0;for(0==r&&(n=i.createRange(),n.setStart(e,0)),o=this.break-r,o>s&&(r+=s,a=s);s>a;)r=this.break,a+=this.break,a>=s?r=s-(a-this.break):(n.setEnd(e,a),cfi=t.cfiFromRange(n),this._locations.push(cfi),r=0,a+=1,n=i.createRange(),n.setStart(e,a))}.bind(this)),n&&(n.setEnd(prev,prev.length),cfi=t.cfiFromRange(n),this._locations.push(cfi),r=0)}.bind(this))},n.prototype.sprint=function(t,e){for(var n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);node=n.nextNode();)e(node)},n.prototype.locationFromCfi=function(t){return 0===this._locations.length?-1:i.locationOf(t,this._locations,this.epubcfi.compare)},n.prototype.precentageFromCfi=function(t){var e=this.locationFromCfi(t);return this.precentageFromLocation(e)},n.prototype.percentageFromLocation=function(t){return t&&this.total?t/this.total:0},n.prototype.cfiFromLocation=function(t){var e=-1;return"number"!=typeof t&&(t=parseInt(pg)),t>=0&&t<this._locations.length&&(e=this._locations[t]),e},n.prototype.cfiFromPercentage=function(t){var e=t>1?t/100:t,n=Math.ceil(this.total*e);return this.cfiFromLocation(n)},n.prototype.load=function(t){return this._locations=JSON.parse(t),this.total=this._locations.length-1,this._locations},n.prototype.save=function(){return JSON.stringify(this._locations)},n.prototype.getCurrent=function(){return this._current},n.prototype.setCurrent=function(t){var e;if("string"==typeof t)this._currentCfi=t;else{if("number"!=typeof t)return;this._current=t}0!==this._locations.length&&("string"==typeof t?(e=this.locationFromCfi(t),this._current=e):e=t,this.trigger("changed",{percentage:this.precentageFromLocation(e)}))},Object.defineProperty(n.prototype,"currentLocation",{get:function(){return this._current},set:function(t){this.setCurrent(t)}}),s.EventTarget.mixin(n.prototype),e.exports=n},{"./core":10,"./epubcfi":11,"./queue":20,rsvp:3}],16:[function(t,e){function n(t){this.layout=t}n.prototype.section=function(t){var e=this.findRanges(t),n=this.rangeListToCfiList(t,e);return n},n.prototype.page=function(t,e,n){if(!t.document)return{start:0,end:0};var i=t.document.body;return this.rangePairToCfiPair(t.section,{start:this.findStart(i,e,n),end:this.findEnd(i,e,n)})},n.prototype.walk=function(t,e){for(var n,i,r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return t.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);(n=r.nextNode())&&!(i=e(n)););return i},n.prototype.findRanges=function(t){for(var e,n,i=[],r=this.layout.count(t),o=this.layout.column,s=this.layout.gap,a=0;a<r.pages;a++)e=(o+s)*a,n=o*(a+1)+s*a,i.push({start:this.findStart(t.document.body,e,n),end:this.findEnd(t.document.body,e,n)});return i},n.prototype.findStart=function(t,e,n){for(var i,r,o=[t],s=t;o.length;)if(i=o.shift(),r=this.walk(i,function(t){var i,r,a,h;return t.nodeType==Node.TEXT_NODE?(h=document.createRange(),h.selectNodeContents(t),a=h.getBoundingClientRect()):a=t.getBoundingClientRect(),i=a.left,r=a.right,i>=e&&n>=i?t:r>e?t:(s=t,o.push(t),void 0)}))return this.findTextStartRange(r,e,n);return this.findTextStartRange(s,e,n)},n.prototype.findEnd=function(t,e,n){for(var i,r,o=[t],s=t;o.length;)if(i=o.shift(),r=this.walk(i,function(t){var e,i,r,a;return t.nodeType==Node.TEXT_NODE?(a=document.createRange(),a.selectNodeContents(t),r=a.getBoundingClientRect()):r=t.getBoundingClientRect(),e=r.left,i=r.right,e>n&&s?s:i>n?t:(s=t,o.push(t),void 0)}))return this.findTextEndRange(r,e,n);return this.findTextEndRange(s,e,n)},n.prototype.findTextStartRange=function(t,e){for(var n,i,r,o=this.splitTextNodeIntoRanges(t),s=0;s<o.length;s++){if(i=o[s],r=i.getBoundingClientRect(),r.left>=e)return i;n=i}return o[0]},n.prototype.findTextEndRange=function(t,e,n){for(var i,r,o,s=this.splitTextNodeIntoRanges(t),a=0;a<s.length;a++){if(r=s[a],o=r.getBoundingClientRect(),o.left>n&&i)return i;if(o.right>n)return r;i=r}return s[s.length-1]},n.prototype.splitTextNodeIntoRanges=function(t,e){var n,i=[],r=t.textContent||"",o=r.trim(),s=t.ownerDocument,a=e||" ";if(pos=o.indexOf(a),-1===pos||t.nodeType!=Node.TEXT_NODE)return n=s.createRange(),n.selectNodeContents(t),[n];for(n=s.createRange(),n.setStart(t,0),n.setEnd(t,pos),i.push(n),n=!1;-1!=pos;)pos=o.indexOf(a,pos+1),pos>0&&(n&&(n.setEnd(t,pos),i.push(n)),n=s.createRange(),n.setStart(t,pos+1));return n&&(n.setEnd(t,o.length),i.push(n)),i},n.prototype.rangePairToCfiPair=function(t,e){var n=e.start,i=e.end;return n.collapse(!0),i.collapse(!0),startCfi=t.cfiFromRange(n),endCfi=t.cfiFromRange(i),{start:startCfi,end:endCfi}},n.prototype.rangeListToCfiList=function(t,e){for(var n,i=[],r=0;r<e.length;r++)n=this.rangePairToCfiPair(t.section,e[r]),i.push(n);return i},e.exports=n},{}],17:[function(t,e){function n(e,n){var s=this,a=new i,h=n||t("./request");this.package=e,this.toc=[],this.tocByHref={},this.tocById={},e.navPath&&(this.navUrl=o(e.navPath).absoluteTo(e.baseUrl).toString(),this.nav={},this.nav.load=function(){var t=new r.defer,e=t.promise;return h(s.navUrl,"xml").then(function(e){s.toc=a.nav(e),s.loaded(s.toc),t.resolve(s.toc)}),e}),e.ncxPath&&(this.ncxUrl=o(e.ncxPath).absoluteTo(e.baseUrl).toString(),this.ncx={},this.ncx.load=function(){var t=new r.defer,e=t.promise;return h(s.ncxUrl,"xml").then(function(e){s.toc=a.toc(e),s.loaded(s.toc),t.resolve(s.toc)}),e})}var i=(t("./core"),t("./parser")),r=t("rsvp"),o=t("urijs");n.prototype.load=function(e){{var n,i;e||t("./request")}return this.nav?n=this.nav.load():this.ncx?n=this.ncx.load():(i=new r.defer,i.resolve([]),n=i.promise),n},n.prototype.loaded=function(t){for(var e,n=0;n<t.length;n++)e=t[n],this.tocByHref[e.href]=n,this.tocById[e.id]=n},n.prototype.get=function(t){var e;return t?(0===t.indexOf("#")?e=this.tocById[t.substring(1)]:t in this.tocByHref&&(e=this.tocByHref[t]),this.toc[e]):this.toc},e.exports=n},{"./core":10,"./parser":19,"./request":23,rsvp:3,urijs:6}],18:[function(t,e){function n(t,e){o.apply(this,arguments),this.settings=r.extend(this.settings||{},{width:600,height:400,axis:"horizontal",forceSingle:!1,minSpreadWidth:800,gap:"auto",overflow:"hidden",infinite:!1}),r.extend(this.settings,e),this.isForcedSingle=this.settings.forceSingle,this.viewSettings.axis=this.settings.axis,this.start()}var i=t("rsvp"),r=t("./core"),o=t("./continuous"),s=t("./map"),a=t("./layout");n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.determineSpreads=function(t){return this.isForcedSingle||!t||this.bounds().width<t?1:2},n.prototype.forceSingle=function(t){this.isForcedSingle=t===!1?!1:!0,this.applyLayoutMethod()},n.prototype.start=function(){this.on("displayed",this.reportLocation.bind(this)),this.currentPage=0,window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this))},n.prototype.applyLayoutMethod=function(){this.layout=new a.Reflowable,this.updateLayout(),this.map=new s(this.layout)},n.prototype.updateLayout=function(){this.spreads=this.determineSpreads(this.settings.minSpreadWidth),this.layout.calculate(this.stage.width,this.stage.height,this.settings.gap,this.spreads),this.settings.offset=this.layout.delta},n.prototype.moveTo=function(t){var e=Math.floor(t.left/this.layout.delta)*this.layout.delta;return this.check(0,e+this.settings.offset).then(function(){this.scrollBy(e,0)}.bind(this))},n.prototype.page=function(){},n.prototype.next=function(){return this.q.enqueue(function(){return this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<this.container.scrollWidth?this.scrollBy(this.layout.delta,0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0),this.reportLocation(),this.check()})},n.prototype.prev=function(){return this.q.enqueue(function(){return this.scrollBy(-this.layout.delta,0),this.reportLocation(),this.check()})},n.prototype.currentLocation=function(){var t,e,n,i,r,o,s=this.visible(),a=this.container.getBoundingClientRect();return 1===s.length?(t=a.left-s[0].position().left,n=t+this.layout.spread,this.map.page(s[0],t,n)):s.length>1?(t=a.left-s[0].position().left,n=t+this.layout.column,e=a.left+this.layout.spread-s[s.length-1].position().left,i=e+this.layout.column,r=this.map.page(s[0],t,n),o=this.map.page(s[s.length-1],e,i),{start:r.start,end:o.end}):void 0},n.prototype.resize=function(t,e){this.q.clear(),this.stageSize(t,e),this.updateLayout(),this.location&&this.display(this.location.start),this.trigger("resized",{width:this.stage.width,height:this.stage.height})},n.prototype.onResized=function(){this.views.clear(),clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)},n.prototype.adjustImages=function(t){return t.addStylesheetRules([["img",["max-width",this.layout.spread+"px"],["max-height",this.layout.height+"px"]]]),new i.Promise(function(t){setTimeout(function(){t()},1)})},e.exports=n},{"./continuous":9,"./core":10,"./layout":14,"./map":16,rsvp:3}],19:[function(t,e){function n(){}var i=t("urijs"),r=(t("./core"),t("rsvp"),t("./epubcfi"));n.prototype.container=function(t){var e,n,r,o;return t?(e=t.querySelector("rootfile"))?(n=e.getAttribute("full-path"),r=i(n).directory(),o=t.xmlEncoding,{packagePath:n,basePath:r,encoding:o}):(console.error("No RootFile Found"),void 0):(console.error("Container File Not Found"),void 0)},n.prototype.identifier=function(t){var e;return t?(e=t.querySelector("metadata"),e?this.getElementText(e,"identifier"):(console.error("No Metadata Found"),void 0)):(console.error("Package File Not Found"),void 0)},n.prototype.packageContents=function(t){var e,n,i,r,o,s,a,h,u,c,p=this;return t?(e=t.querySelector("metadata"))?(n=t.querySelector("manifest"))?(i=t.querySelector("spine"))?(r=p.manifest(n),o=p.findNavPath(n),s=p.findNcxPath(n,i),a=p.findCoverPath(t),h=Array.prototype.indexOf.call(i.parentNode.childNodes,i),u=p.spine(i,r),c=p.metadata(e),c.direction=i.getAttribute("page-progression-direction"),{metadata:c,spine:u,manifest:r,navPath:o,ncxPath:s,coverPath:a,spineNodeIndex:h}):(console.error("No Spine Found"),void 0):(console.error("No Manifest Found"),void 0):(console.error("No Metadata Found"),void 0):(console.error("Package File Not Found"),void 0)},n.prototype.findNavPath=function(t){var e=t.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");return e?e.getAttribute("href"):!1},n.prototype.findNcxPath=function(t,e){var n,i=t.querySelector("item[media-type='application/x-dtbncx+xml']");return i||(n=e.getAttribute("toc"),n&&(i=t.querySelector("item[id='"+n+"']"))),i?i.getAttribute("href"):!1},n.prototype.metadata=function(t){var e={},n=this;return e.title=n.getElementText(t,"title"),e.creator=n.getElementText(t,"creator"),e.description=n.getElementText(t,"description"),e.pubdate=n.getElementText(t,"date"),e.publisher=n.getElementText(t,"publisher"),e.identifier=n.getElementText(t,"identifier"),e.language=n.getElementText(t,"language"),e.rights=n.getElementText(t,"rights"),e.modified_date=n.querySelectorText(t,"meta[property='dcterms:modified']"),e.layout=n.querySelectorText(t,"meta[property='rendition:layout']"),e.orientation=n.querySelectorText(t,"meta[property='rendition:orientation']"),e.spread=n.querySelectorText(t,"meta[property='rendition:spread']"),e},n.prototype.findCoverPath=function(t,e){var n=e?"2.0":t.querySelector("package").getAttribute("version");if("2.0"===n){var i=t.querySelector('meta[name="cover"]');if(i){var r=i.getAttribute("content"),o=t.querySelector("item[id='"+r+"']");
return o?o.getAttribute("href"):!1}return!1}var s=t.querySelector("item[properties='cover-image']");return s?s.getAttribute("href"):this.findCoverPath(t,!0)},n.prototype.getElementText=function(t,e){var n,i=t.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",e);return i&&0!==i.length?(n=i[0],n.childNodes.length?n.childNodes[0].nodeValue:""):""},n.prototype.querySelectorText=function(t,e){var n=t.querySelector(e);return n&&n.childNodes.length?n.childNodes[0].nodeValue:""},n.prototype.manifest=function(t){var e={},n=t.querySelectorAll("item"),i=Array.prototype.slice.call(n);return i.forEach(function(t){var n=t.getAttribute("id"),i=t.getAttribute("href")||"",r=t.getAttribute("media-type")||"",o=t.getAttribute("properties")||"";e[n]={href:i,type:r,properties:o.length?o.split(" "):[]}}),e},n.prototype.spine=function(t){{var e=[],n=t.getElementsByTagName("itemref"),i=Array.prototype.slice.call(n);new r}return i.forEach(function(t,n){var i=t.getAttribute("idref"),r=t.getAttribute("properties")||"",o=r.length?r.split(" "):[],s={idref:i,linear:t.getAttribute("linear")||"",properties:o,index:n};e.push(s)}),e},n.prototype.querySelectorByType=function(t,e,n){var i=t.querySelector(e+'[*|type="'+n+'"]');if(null!==i&&0!==i.length)return i;i=t.querySelectorAll(e);for(var r=0;r<i.length;r++)if(i[r].getAttributeNS("http://www.idpf.org/2007/ops","type")===n)return i[r]},n.prototype.nav=function(t,e,n){var i,r,o,s=this.querySelectorByType(t,"nav","toc"),a=s?s.querySelectorAll("ol li"):[],h=a.length,u={},c=[];if(!a||0===h)return c;for(i=0;h>i;++i)r=this.navItem(a[i],e,n),u[r.id]=r,r.parent?(o=u[r.parent],o.subitems.push(r)):c.push(r);return c},n.prototype.navItem=function(t){var e,n=t.getAttribute("id")||!1,i=t.querySelector("a, span"),r=i.getAttribute("href")||"",o=i.textContent||"",s=[],a=t.parentNode;return a&&"navPoint"===a.nodeName&&(e=a.getAttribute("id")),{id:n,href:r,label:o,subitems:s,parent:e}},n.prototype.toc=function(t,e,n){var i,r,o,s=t.querySelectorAll("navMap navPoint"),a=s.length,h={},u=[];if(!s||0===a)return u;for(i=0;a>i;++i)r=this.tocItem(s[i],e,n),h[r.id]=r,r.parent?(o=h[r.parent],o.subitems.push(r)):u.push(r);return u},n.prototype.tocItem=function(t){var e,n=t.getAttribute("id")||!1,i=t.querySelector("content"),r=i.getAttribute("src"),o=t.querySelector("navLabel"),s=o.textContent?o.textContent:"",a=[],h=t.parentNode;return h&&"navPoint"===h.nodeName&&(e=h.getAttribute("id")),{id:n,href:r,label:s,subitems:a,parent:e}},n.prototype.pageList=function(t,e,n){var i,r,o=this.querySelectorByType(t,"nav","page-list"),s=o?o.querySelectorAll("ol li"):[],a=s.length,h=[];if(!s||0===a)return h;for(i=0;a>i;++i)r=this.pageListItem(s[i],e,n),h.push(r);return h},n.prototype.pageListItem=function(t){var e,n,i,r=(t.getAttribute("id")||!1,t.querySelector("a")),o=r.getAttribute("href")||"",s=r.textContent||"",a=parseInt(s),h=o.indexOf("epubcfi");return-1!=h?(e=o.split("#"),n=e[0],i=e.length>1?e[1]:!1,{cfi:i,href:o,packageUrl:n,page:a}):{href:o,page:a}},e.exports=n},{"./core":10,"./epubcfi":11,rsvp:3,urijs:6}],20:[function(t,e){function n(t){this._q=[],this.context=t,this.tick=r.requestAnimationFrame,this.running=!1,this.paused=!1}var i=t("rsvp"),r=t("./core");n.prototype.enqueue=function(){var t,e,n,r=[].shift.call(arguments),o=arguments;return r?("function"==typeof r?(t=new i.defer,e=t.promise,n={task:r,args:o,deferred:t,promise:e}):n={promise:r},this._q.push(n),0!=this.paused||this.running||this.run(),n.promise):console.error("No Task Provided")},n.prototype.dequeue=function(){var t,e,n;return this._q.length?(t=this._q.shift(),(e=t.task)?(n=e.apply(this.context,t.args),n&&"function"==typeof n.then?n.then(function(){t.deferred.resolve.apply(this.context,arguments)}.bind(this)):(t.deferred.resolve.apply(this.context,n),t.promise)):t.promise?t.promise:void 0):(t=new i.defer,t.deferred.resolve(),t.promise)},n.prototype.dump=function(){for(;this._q.length;)this.dequeue()},n.prototype.run=function(){return this.running||(this.running=!0,this.defered=new i.defer),this.tick.call(window,function(){this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}.bind(this)),1==this.paused&&(this.paused=!1),this.defered.promise},n.prototype.flush=function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0},n.prototype.clear=function(){this._q=[],this.running=!1},n.prototype.length=function(){return this._q.length},n.prototype.pause=function(){this.paused=!0},e.exports=n},{"./core":10,rsvp:3}],21:[function(t,e){function n(t,e){this.settings=o.extend(this.settings||{},{infinite:!0,hidden:!1,width:!1,height:null,layoutOveride:null,axis:"vertical",ignoreClass:""}),o.extend(this.settings,e),this.viewSettings={ignoreClass:this.settings.ignoreClass},this.book=t,this.views=null,this.hooks={},this.hooks.display=new a(this),this.hooks.serialize=new a(this),this.hooks.content=new a(this),this.hooks.layout=new a(this),this.hooks.render=new a(this),this.hooks.show=new a(this),this.hooks.content.register(s.links.bind(this)),this.hooks.content.register(this.passViewEvents.bind(this)),this.epubcfi=new h,this.q=new u(this),this.q.enqueue(this.book.opened),this.q.enqueue(this.parseLayoutProperties),this.book.archive&&this.replacements()}var i=t("rsvp"),r=t("urijs"),o=t("./core"),s=t("./replacements"),a=t("./hook"),h=t("./epubcfi"),u=t("./queue"),c=t("./view"),p=t("./views"),l=t("./layout"),d=t("./map");n.prototype.initialize=function(t){{var e,n=t||{},i=n.height,r=n.width;n.hidden||!1}return n.height&&o.isNumber(n.height)&&(i=n.height+"px"),n.width&&o.isNumber(n.width)&&(r=n.width+"px"),e=document.createElement("div"),e.id="epubjs-container:"+o.uuid(),e.classList.add("epub-container"),e.style.fontSize="0",e.style.wordSpacing="0",e.style.lineHeight="0",e.style.verticalAlign="top","horizontal"===this.settings.axis&&(e.style.whiteSpace="nowrap"),r&&(e.style.width=r),i&&(e.style.height=i),e.style.overflow=this.settings.overflow,e},n.wrap=function(t){var e=document.createElement("div");return e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="0",e.style.height="0",e.appendChild(t),e},n.prototype.attachTo=function(t){return this.container=this.initialize({width:this.settings.width,height:this.settings.height}),o.isElement(t)?this.element=t:"string"==typeof t&&(this.element=document.getElementById(t)),this.element?(this.settings.hidden?(this.wrapper=this.wrap(this.container),this.element.appendChild(this.wrapper)):this.element.appendChild(this.container),this.views=new p(this.container),this.attachListeners(),this.stageSize(),this.applyLayoutMethod(),this.trigger("attached"),void 0):(console.error("Not an Element"),void 0)},n.prototype.attachListeners=function(){o.isNumber(this.settings.width)&&o.isNumber(this.settings.height)||window.addEventListener("resize",this.onResized.bind(this),!1)},n.prototype.bounds=function(){return this.container.getBoundingClientRect()},n.prototype.display=function(t){return this.q.enqueue(this._display,t)},n.prototype._display=function(t){var e,n,r,o,s,a=new i.defer,h=a.promise,u=this.epubcfi.isCfiString(t),c=this.book.baseUrl.split("/").pop();return c||(c=this.book.baseUrl.substring(0,this.book.baseUrl.length-1).split("/").pop()),0===t.indexOf(c)&&(t=t.replace(c+"/","")),(e=this.book.spine.get(t))?(s=this.views.find(e),s?(r=s.locationOf(t),this.moveTo(r),a.resolve()):(this.views.hide(),n=this.createView(e),h=this.fill(n).then(function(){return"string"==typeof t&&t.indexOf("#")>-1&&(o=t.substring(t.indexOf("#")+1)),u||o?(r=n.locationOf(t),this.moveTo(r)):"function"==typeof this.check?this.check():void 0}.bind(this)).then(function(){return this.hooks.display.trigger(n)}.bind(this)).then(function(){this.views.show()}.bind(this))),h.then(function(){this.trigger("displayed",e)}.bind(this)),h):(a.reject(new Error("No Section Found")),h)},n.prototype.moveTo=function(t){this.scrollTo(t.left,t.top)},n.prototype.render=function(t,e){return t.create(),t.onLayout=this.layout.format.bind(this.layout),this.resizeView(t),t.render(this.book.request).then(function(){return this.hooks.content.trigger(t,this)}.bind(this)).then(function(){return this.hooks.layout.trigger(t,this)}.bind(this)).then(function(){return t.display()}.bind(this)).then(function(){return this.hooks.render.trigger(t,this)}.bind(this)).then(function(){e!==!1&&this.views.hidden===!1&&this.q.enqueue(function(t){t.show()},t),this.hooks.show.trigger(t,this),this.trigger("rendered",t.section)}.bind(this)).catch(function(t){this.trigger("loaderror",t)}.bind(this))},n.prototype.afterDisplayed=function(t){this.trigger("added",t.section),this.reportLocation()},n.prototype.fill=function(t){return this.views.clear(),this.views.append(t),t.onDisplayed=this.afterDisplayed.bind(this),this.render(t)},n.prototype.resizeView=function(t){"pre-paginated"===this.globalLayoutProperties.layout?t.lock("both",this.stage.width,this.stage.height):t.lock("width",this.stage.width,this.stage.height)},n.prototype.stageSize=function(t,e){var n,i=t||this.settings.width,r=e||this.settings.height;return i===!1&&(n=this.element.getBoundingClientRect(),n.width&&(i=n.width,this.container.style.width=n.width+"px")),r===!1&&(n=n||this.element.getBoundingClientRect(),n.height&&(r=n.height,this.container.style.height=n.height+"px")),i&&!o.isNumber(i)&&(n=this.container.getBoundingClientRect(),i=n.width),r&&!o.isNumber(r)&&(n=n||this.container.getBoundingClientRect(),r=n.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0},this.stage={width:i-this.containerPadding.left-this.containerPadding.right,height:r-this.containerPadding.top-this.containerPadding.bottom},this.stage},n.prototype.applyLayoutMethod=function(){this.layout=new l.Scroll,this.updateLayout(),this.map=new d(this.layout)},n.prototype.updateLayout=function(){this.layout.calculate(this.stage.width,this.stage.height)},n.prototype.resize=function(t,e){this.stageSize(t,e),this.updateLayout(),this.views.each(this.resizeView.bind(this)),this.trigger("resized",{width:this.stage.width,height:this.stage.height})},n.prototype.onResized=function(){var t=window.scrollY;this.resize(),window.scrollTo(0,t)},n.prototype.createView=function(t){return t.hooks.serialize.register(this.hooks.serialize.list()),new c(t,this.viewSettings)},n.prototype.next=function(){return this.q.enqueue(function(){var t,e;return this.views.length?(t=this.views.last().section.next(),t?(e=this.createView(t),this.fill(e)):void 0):void 0})},n.prototype.prev=function(){return this.q.enqueue(function(){var t,e;return this.views.length?(t=this.views.first().section.prev(),t?(e=this.createView(t),this.fill(e)):void 0):void 0})},n.prototype.parseLayoutProperties=function(t){var e=t||this.book.package.metadata,n=this.layoutOveride&&this.layoutOveride.layout||e.layout||"reflowable",i=this.layoutOveride&&this.layoutOveride.spread||e.spread||"auto",r=this.layoutOveride&&this.layoutOveride.orientation||e.orientation||"auto";return this.globalLayoutProperties={layout:n,spread:i,orientation:r},this.globalLayoutProperties},n.prototype.current=function(){var t=this.visible();return t.length?t[t.length-1]:null},n.prototype.isVisible=function(t,e,n,i){var r=t.position(),o=i||this.container.getBoundingClientRect();return"horizontal"===this.settings.axis&&r.right>o.left-e&&r.left<o.right+n?!0:"vertical"===this.settings.axis&&r.bottom>o.top-e&&r.top<o.bottom+n?!0:!1},n.prototype.visible=function(){for(var t,e,n=this.bounds(),i=this.views.displayed(),r=[],o=0;o<i.length;o++)e=i[o],t=this.isVisible(e,0,0,n),t===!0&&r.push(e);return r},n.prototype.bounds=function(){var t;return t=this.settings.height?this.container.getBoundingClientRect():o.windowBounds()},n.prototype.destroy=function(){this.q.clear(),this.views.clear(),clearTimeout(this.trimTimeout),this.settings.hidden?this.element.removeChild(this.wrapper):this.element.removeChild(this.container)},n.prototype.reportLocation=function(){return this.q.enqueue(function(){this.location=this.currentLocation(),this.trigger("locationChanged",this.location)}.bind(this))},n.prototype.currentLocation=function(){var t;return this.views.length?(t=this.views.first(),this.map.page(t)):void 0},n.prototype.scrollBy=function(t,e,n){n&&(this.ignore=!0),this.settings.height?(t&&(this.container.scrollLeft+=t),e&&(this.container.scrollTop+=e)):window.scrollBy(t,e),this.scrolled=!0},n.prototype.scrollTo=function(t,e,n){n&&(this.ignore=!0),this.settings.height?(this.container.scrollLeft=t,this.container.scrollTop=e):window.scrollTo(t,e),this.scrolled=!0},n.prototype.passViewEvents=function(t){t.listenedEvents.forEach(function(e){t.on(e,this.triggerViewEvent.bind(this))}.bind(this)),t.on("selected",this.triggerSelectedEvent.bind(this))},n.prototype.triggerViewEvent=function(t){this.trigger(t.type,t)},n.prototype.triggerSelectedEvent=function(t){this.trigger("selected",t)},n.prototype.replacements=function(){return this.q.enqueue(function(){var t=this.book.package.manifest,e=Object.keys(t).map(function(e){return t[e]}),n=e.filter(function(t){return"application/xhtml+xml"!=t.type&&"text/html"!=t.type?!0:void 0}),o=n.filter(function(t){return"text/css"===t.type?!0:void 0}),s=o.map(function(t){return t.href}),a=n.map(function(t){return t.href}.bind(this)),h=a.map(function(t){var e=r(t).absoluteTo(this.book.baseUrl).toString();return this.book.archive.createUrl(e)}.bind(this));return i.all(h).then(function(t){s.forEach(function(e){this.replaceCss(e,a,t)}.bind(this)),this.hooks.serialize.register(function(e,n){this.replaceAssets(n,a,t)}.bind(this))}.bind(this)).catch(function(t){console.error(t)})}.bind(this))},n.prototype.replaceCss=function(t,e,n){var i,a,h=r(t),u=h.absoluteTo(this.book.baseUrl).toString(),c=this.book.archive.getText(u),p=e.map(function(t){var e=r(t).absoluteTo(this.book.baseUrl),n=e.relativeTo(u).toString();return n}.bind(this));c=s.substitute(c,p,n),i=o.createBlobUrl(c,"text/css"),a=e.indexOf(t),a>-1&&(n[a]=i)},n.prototype.replaceAssets=function(t,e,n){var i=r(t.url),o=e.map(function(t){var e=r(t).absoluteTo(this.book.baseUrl),n=e.relativeTo(i).toString();return n}.bind(this));t.output=s.substitute(t.output,o,n)},n.prototype.range=function(t,e){var n=new h(t),i=this.visible().filter(function(t){return n.spinePos===t.index?!0:void 0});return i.length?i[0].range(n,e):void 0},i.EventTarget.mixin(n.prototype),e.exports=n},{"./core":10,"./epubcfi":11,"./hook":13,"./layout":14,"./map":16,"./queue":20,"./replacements":22,"./view":27,"./views":28,rsvp:3,urijs:6}],22:[function(t,e){function n(t,e){var n,i;t&&(i=t.querySelector("head"),n=i.querySelector("base"),n||(n=t.createElement("base")),n.setAttribute("href",e.url),i.insertBefore(n,i.firstChild))}function i(t,e){for(var n=t.document.querySelectorAll("a[href]"),i=function(n){var i=n.getAttribute("href"),r=o(i),s=r.absoluteTo(t.section.url),a=s.relativeTo(this.book.baseUrl).toString();r.protocol()?n.setAttribute("target","_blank"):n.onclick=function(){return this.trigger("startScrollTo",a),e.display(a).then(function(){this.trigger("scrollTo")}.bind(this)),!1}.bind(this)}.bind(this),r=0;r<n.length;r++)i(n[r])}function r(t,e,n){return e.forEach(function(e,i){e&&n[i]&&(t=t.replace(new RegExp(e,"g"),n[i]))}),t}{var o=t("urijs");t("./core")}e.exports={base:n,links:i,substitute:r}},{"./core":10,urijs:6}],23:[function(t,e){function n(t,e,n,s){function a(t){console.error(t),d.reject(t)}function h(){if(this.readyState===XMLHttpRequest.DONE)if(200===this.status||this.responseXML){var t;if(!this.response&&!this.responseXML)return d.reject({status:this.status,message:"Empty Response",stack:(new Error).stack}),d.promise;""!=this.responseType&&"document"!=this.responseType||!this.responseXML?o.isXml(e)?t=(new DOMParser).parseFromString(this.response,"text/xml"):"xhtml"==e?(console.log(this.response),t=(new DOMParser).parseFromString(this.response,"application/xhtml+xml")):t="html"==e||"htm"==e?(new DOMParser).parseFromString(this.response,"text/html"):"json"==e?JSON.parse(this.response):"blob"==e?p?this.response:new Blob([this.response]):this.response:t=this.responseXML,d.resolve(t)}else d.reject({status:this.status,message:this.response,stack:(new Error).stack})}var u,c,p="undefined"!=typeof window?window.URL:!1,l=p?"blob":"arraybuffer",d=new i.defer,f=new XMLHttpRequest,g=XMLHttpRequest.prototype;"overrideMimeType"in g||Object.defineProperty(g,"overrideMimeType",{value:function(){}}),n&&(f.withCredentials=!0),f.onreadystatechange=h,f.onerror=a,f.open("GET",t,!0);for(c in s)f.setRequestHeader(c,s[c]);return"json"==e&&f.setRequestHeader("Accept","application/json"),e||(u=r(t),e=u.suffix()),"blob"==e&&(f.responseType=l),o.isXml(e)&&(f.responseType="document",f.overrideMimeType("text/xml")),"xhtml"==e&&(f.responseType="document"),("html"==e||"htm"==e)&&(f.responseType="document"),"binary"==e&&(f.responseType="arraybuffer"),f.send(),d.promise}var i=t("rsvp"),r=t("urijs"),o=t("./core");e.exports=n},{"./core":10,rsvp:3,urijs:6}],24:[function(t,e){function n(t){this.idref=t.idref,this.linear=t.linear,this.properties=t.properties,this.index=t.index,this.href=t.href,this.url=t.url,this.next=t.next,this.prev=t.prev,this.cfiBase=t.cfiBase,this.hooks={},this.hooks.serialize=new s(this),this.hooks.content=new s(this),this.hooks.content.register(a.base)}var i=t("rsvp"),r=t("urijs"),o=(t("./core"),t("./epubcfi")),s=t("./hook"),a=t("./replacements");n.prototype.load=function(e){var n=e||this.request||t("./request"),o=new i.defer,s=o.promise;return this.contents?o.resolve(this.contents):n(this.url).then(function(t){r(this.url).directory();return this.document=t,this.contents=t.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){o.resolve(this.contents)}.bind(this)).catch(function(t){o.reject(t)}),s},n.prototype.base=function(t){var e,n=new i.defer,r=t.createElement("base");return r.setAttribute("href",this.url),t&&(e=t.querySelector("head")),e?(e.insertBefore(r,e.firstChild),n.resolve()):n.reject(new Error("No head to insert into")),n.promise},n.prototype.beforeSectionLoad=function(){},n.prototype.render=function(t){var e=new i.defer,n=e.promise;return this.output,this.load(t).then(function(t){var e=new XMLSerializer;return this.output=e.serializeToString(t),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){e.resolve(this.output)}.bind(this)).catch(function(t){e.reject(t)}),n},n.prototype.find=function(){},n.prototype.reconcileLayoutSettings=function(t){var e={layout:t.layout,spread:t.spread,orientation:t.orientation};return this.properties.forEach(function(t){var n,i,r=t.replace("rendition:",""),o=r.indexOf("-");-1!=o&&(n=r.slice(0,o),i=r.slice(o+1),e[n]=i)}),e},n.prototype.cfiFromRange=function(t){return new o(t,this.cfiBase).toString()},n.prototype.cfiFromElement=function(t){return new o(t,this.cfiBase).toString()},e.exports=n},{"./core":10,"./epubcfi":11,"./hook":13,"./replacements":22,"./request":23,rsvp:3,urijs:6}],25:[function(t,e){function n(t){this.request=t,this.spineItems=[],this.spineByHref={},this.spineById={}}var i=(t("rsvp"),t("./core"),t("./epubcfi")),r=t("./section");n.prototype.load=function(t){this.items=t.spine,this.manifest=t.manifest,this.spineNodeIndex=t.spineNodeIndex,this.baseUrl=t.baseUrl||"",this.length=this.items.length,this.epubcfi=new i,this.items.forEach(function(t,e){var n,i=this.manifest[t.idref];t.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,t.index,t.idref),i&&(t.href=i.href,t.url=this.baseUrl+t.href,i.properties.length&&t.properties.push.apply(t.properties,i.properties)),t.prev=function(){return this.get(e-1)}.bind(this),t.next=function(){return this.get(e+1)}.bind(this),n=new r(t),this.append(n)}.bind(this))},n.prototype.get=function(t){var e=0;return this.epubcfi.isCfiString(t)?(cfi=new i(t),e=cfi.spinePos):!t||"number"!=typeof t&&isNaN(t)!==!1?t&&0===t.indexOf("#")?e=this.spineById[t.substring(1)]:t&&(t=t.split("#")[0],e=this.spineByHref[t]):e=t,this.spineItems[e]||null},n.prototype.append=function(t){var e=this.spineItems.length;return t.index=e,this.spineItems.push(t),this.spineByHref[t.href]=e,this.spineById[t.idref]=e,e},n.prototype.prepend=function(t){this.spineItems.unshift(t);return this.spineByHref[t.href]=0,this.spineById[t.idref]=0,this.spineItems.forEach(function(t,e){t.index=e}),0},n.prototype.insert=function(){},n.prototype.remove=function(t){var e=this.spineItems.indexOf(t);return e>-1?(delete this.spineByHref[t.href],delete this.spineById[t.idref],this.spineItems.splice(e,1)):void 0},n.prototype.each=function(){return this.spineItems.forEach.apply(this.spineItems,arguments)},e.exports=n},{"./core":10,"./epubcfi":11,"./section":24,rsvp:3}],26:[function(t,e){function n(){this.checkRequirements(),this.urlCache={}}var i=t("rsvp"),r=t("urijs"),o=t("./core"),s=t("./request"),a=t("../libs/mime/mime");n.prototype.checkRequirements=function(){try{"undefined"!=typeof JSZip?this.zip=new JSZip:(JSZip=t("jszip"),this.zip=new JSZip)}catch(e){console.error("JSZip lib not loaded")}},n.prototype.open=function(t){return t instanceof ArrayBuffer?new i.Promise(function(e){this.zip=new JSZip(t),e(this.zip)}):s(t,"binary").then(function(t){return this.zip=new JSZip(t),this.zip}.bind(this))},n.prototype.request=function(t,e){var n,o,s=new i.defer;return e||(uri=r(t),e=uri.suffix()),n="blob"==e?this.getBlob(t):this.getText(t),n?(o=this.handleResponse(n,e),s.resolve(o)):s.reject({message:"File not found in the epub: "+t,stack:(new Error).stack}),s.promise},n.prototype.handleResponse=function(t,e){var n;return n="json"==e?JSON.parse(t):o.isXml(e)?(new DOMParser).parseFromString(t,"text/xml"):"xhtml"==e?(new DOMParser).parseFromString(t,"application/xhtml+xml"):"html"==e||"htm"==e?(new DOMParser).parseFromString(t,"text/html"):t},n.prototype.getBlob=function(t,e){var n,i=window.decodeURIComponent(t.substr(1)),r=this.zip.file(i);return r?(n=e||a.lookup(r.name),new Blob([r.asUint8Array()],{type:n})):void 0},n.prototype.getText=function(t){var e=window.decodeURIComponent(t.substr(1)),n=this.zip.file(e);return n?n.asText():void 0},n.prototype.createUrl=function(t){var e,n,r=new i.defer,o=window.URL||window.webkitURL||window.mozURL;return t in this.urlCache?(r.resolve(this.urlCache[t]),r.promise):(n=this.getBlob(t),n?(e=o.createObjectURL(n),r.resolve(e),this.urlCache[t]=e):r.reject({message:"File not found in the epub: "+t,stack:(new Error).stack}),r.promise)},n.prototype.revokeUrl=function(t){var e=window.URL||window.webkitURL||window.mozURL,n=this.urlCache[t];n&&e.revokeObjectURL(n)},e.exports=n},{"../libs/mime/mime":1,"./core":10,"./request":23,jszip:"jszip",rsvp:3,urijs:6}],27:[function(t,e){function n(t,e){this.settings=r.extend({ignoreClass:""},e||{}),this.id="epubjs-view:"+r.uuid(),this.section=t,this.index=t.index,this.element=document.createElement("div"),this.element.classList.add("epub-view"),this.element.style.height="0px",this.element.style.width="0px",this.element.style.overflow="hidden",this.added=!1,this.displayed=!1,this.rendered=!1,this.epubcfi=new o,this.element.style.display=this.settings.axis&&"horizontal"==this.settings.axis?"inline-block":"block",this.listenedEvents=["keydown","keyup","keypressed","mouseup","mousedown","click","touchend","touchstart"]}var i=t("rsvp"),r=t("./core"),o=t("./epubcfi");n.prototype.create=function(){return this.iframe?this.iframe:(this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=r.bounds(this.element),this.supportsSrcdoc=!1,this.iframe)},n.prototype.lock=function(t,e,n){var i,o=r.borders(this.element);i=this.iframe?r.borders(this.iframe):{width:0,height:0},"width"==t&&r.isNumber(e)&&(this.lockedWidth=e-o.width-i.width,this.resize(this.lockedWidth,e)),"height"==t&&r.isNumber(n)&&(this.lockedHeight=n-o.height-i.height,this.resize(e,this.lockedHeight)),"both"===t&&r.isNumber(e)&&r.isNumber(n)&&(this.lockedWidth=e-o.width-i.width,this.lockedHeight=n-o.height-i.height,this.resize(this.lockedWidth,this.lockedHeight)),this.displayed&&this.iframe&&(this.layout(),this.expand())},n.prototype.expand=function(){var t,e,n=this.lockedWidth,i=this.lockedHeight;this.iframe&&!this._expanding&&(this._expanding=!0,i&&!n&&(t=this.textWidth(),t!=this._textWidth?(n=this.contentWidth(t),this._textWidth=t,this._contentWidth=n):n=this._contentWidth),n&&!i&&(e=this.textHeight(),e!=this._textHeight?(i=this.contentHeight(e),this._textHeight=e,this._contentHeight=i):i=this._contentHeight),(this._needsReframe||n!=this._width||i!=this._height)&&this.resize(n,i),this._expanding=!1)},n.prototype.contentWidth=function(t){var e,n;return e=this.iframe.style.width,this.iframe.style.width=(t||0)+"px",n=this.document.body.scrollWidth,this.iframe.style.width=e,n},n.prototype.contentHeight=function(t){var e,n;return e=this.iframe.style.height,this.iframe.style.height=(t||0)+"px",n=this.document.body.scrollHeight,this.iframe.style.height=e,n},n.prototype.textWidth=function(){var t,e=this.document.createRange();return e.selectNodeContents(this.document.body),t=e.getBoundingClientRect().width},n.prototype.textHeight=function(){var t,e=this.document.createRange();return e.selectNodeContents(this.document.body),t=e.getBoundingClientRect().height},n.prototype.resize=function(t,e){this.iframe&&(r.isNumber(t)&&(this.iframe.style.width=t+"px",this._width=t),r.isNumber(e)&&(this.iframe.style.height=e+"px",this._height=e),this.iframeBounds=r.bounds(this.iframe),this.reframe(this.iframeBounds.width,this.iframeBounds.height))},n.prototype.reframe=function(t,e){return this.displayed?(r.isNumber(t)&&(this.element.style.width=t+"px"),r.isNumber(e)&&(this.element.style.height=e+"px"),this.prevBounds=this.elementBounds,this.elementBounds=r.bounds(this.element),this.trigger("resized",{width:this.elementBounds.width,height:this.elementBounds.height,widthDelta:this.elementBounds.width-this.prevBounds.width,heightDelta:this.elementBounds.height-this.prevBounds.height}),void 0):(this._needsReframe=!0,void 0)},n.prototype.resized=function(){},n.prototype.render=function(t){return this.rendering=!0,this.section.render(t).then(function(t){return this.load(t)}.bind(this))},n.prototype.load=function(t){var e=new i.defer,n=e.promise;if(!this.iframe)return e.reject(new Error("No Iframe Available")),n;if(this.iframe.onload=function(){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.rendering=!1,e.resolve(this)}.bind(this),this.supportsSrcdoc)this.iframe.srcdoc=t;else{if(this.document=this.iframe.contentDocument,!this.document)return e.reject(new Error("No Document Available")),n;this.document.open(),this.document.write(t),this.document.close()}return n},n.prototype.layout=function(t){this.iframe.style.display="inline-block",this.document.body.style.margin="0",t&&t(this),this.onLayout(this)},n.prototype.onLayout=function(){},n.prototype.listeners=function(){this.document.fonts&&"loading"===this.document.fonts.status&&(this.document.fonts.onloadingdone=function(){this.expand()}.bind(this)),this.section.properties.indexOf("scripted")>-1&&(this.observer=this.observe(this.document.body)),this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners()},n.prototype.removeListeners=function(){this.removeEventListeners(),this.removeSelectionListeners()},n.prototype.resizeListenters=function(){clearTimeout(this.expanding),this.expanding=setTimeout(this.expand.bind(this),350)},n.prototype.mediaQueryListeners=function(){for(var t=this.document.styleSheets,e=function(t){t.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),n=0;n<t.length;n+=1){var i=t[n].cssRules;if(!i)return;for(var r=0;r<i.length;r+=1)if(i[r].media){var o=this.window.matchMedia(i[r].media.mediaText);o.addListener(e)}}},n.prototype.observe=function(t){var e=this,n=new MutationObserver(function(){e._expanding&&e.expand()}),i={attributes:!0,childList:!0,characterData:!0,subtree:!0};return n.observe(t,i),n},n.prototype.imageLoadListeners=function(){for(var t,e=this.document.body.querySelectorAll("img"),n=0;n<e.length;n++)t=e[n],"undefined"!=typeof t.naturalWidth&&0===t.naturalWidth&&(t.onload=this.expand.bind(this))},n.prototype.display=function(){var t=new i.defer;return this.displayed=!0,this.layout(),this.listeners(),this.expand(),this.trigger("displayed",this),this.onDisplayed(this),t.resolve(this),t.promise},n.prototype.show=function(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible"),this.trigger("shown",this)},n.prototype.hide=function(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.trigger("hidden",this)},n.prototype.position=function(){return this.element.getBoundingClientRect()},n.prototype.onDisplayed=function(){},n.prototype.bounds=function(){return this.elementBounds||(this.elementBounds=r.bounds(this.element)),this.elementBounds},n.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.displayed&&(this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.displayed=!1,this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)},n.prototype.root=function(){return this.document?this.document.documentElement:null},n.prototype.locationOf=function(t){var e=this.iframe.getBoundingClientRect(),n={left:0,top:0};return this.document?(this.epubcfi.isCfiString(t)?(range=new o(t).toRange(this.document,this.settings.ignoreClass),range&&(n=range.commonAncestorContainer.getBoundingClientRect())):"string"==typeof t&&t.indexOf("#")>-1&&(id=t.substring(t.indexOf("#")+1),el=this.document.getElementById(id),el&&(n=el.getBoundingClientRect())),{left:window.scrollX+e.left+n.left,top:window.scrollY+e.top+n.top}):void 0},n.prototype.addCss=function(t){return new i.Promise(function(e){var n,i=!1;return this.document?(n=this.document.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=t,n.onload=n.onreadystatechange=function(){i||this.readyState&&"complete"!=this.readyState||(i=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(n),void 0):(e(!1),void 0)}.bind(this))},n.prototype.addStylesheetRules=function(t){var e,n;if(this.document){e=this.document.createElement("style"),this.document.head.appendChild(e),n=e.sheet;for(var i=0,r=t.length;r>i;i++){var o=1,s=t[i],a=t[i][0],h="";"[object Array]"===Object.prototype.toString.call(s[1][0])&&(s=s[1],o=0);for(var u=s.length;u>o;o++){var c=s[o];h+=c[0]+":"+c[1]+(c[2]?" !important":"")+";\n"}n.insertRule(a+"{"+h+"}",n.cssRules.length)}}},n.prototype.addScript=function(t){return new i.Promise(function(e){var n,i=!1;return this.document?(n=this.document.createElement("script"),n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){i||this.readyState&&"complete"!=this.readyState||(i=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(n),void 0):(e(!1),void 0)}.bind(this))},n.prototype.addEventListeners=function(){this.document&&this.listenedEvents.forEach(function(t){this.document.addEventListener(t,this.triggerEvent.bind(this),!1)},this)},n.prototype.removeEventListeners=function(){this.document&&this.listenedEvents.forEach(function(t){this.document.removeEventListener(t,this.triggerEvent,!1)},this)},n.prototype.triggerEvent=function(t){this.trigger(t.type,t)
},n.prototype.addSelectionListeners=function(){this.document&&this.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)},n.prototype.removeSelectionListeners=function(){this.document&&this.document.removeEventListener("selectionchange",this.onSelectionChange,!1)},n.prototype.onSelectionChange=function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var t=this.window.getSelection();this.triggerSelectedEvent(t)}.bind(this),500)},n.prototype.triggerSelectedEvent=function(t){var e,n;t&&t.rangeCount>0&&(e=t.getRangeAt(0),e.collapsed||(n=this.section.cfiFromRange(e),this.trigger("selected",n),this.trigger("selectedRange",e)))},n.prototype.currentElement=function(){if(this.document){var t=this.iframe.getBoundingClientRect().top+window.scrollY,e=this.document.getElementsByTagName("body")[0].getBoundingClientRect().width/2,n=this.document.elementFromPoint(e,window.scrollY-t),i=5,r=30;if(!n)return this.document.getElementsByTagName("body")[0];for(;"BODY"===n.tagName&&window.scrollY-t-i>t&&0!==r;)n=this.document.elementFromPoint(e,window.scrollY-t-i),r--,i+=5;return n}},n.prototype.getPrevFromIds=function(t){"string"==typeof t&&(t=[t]);for(var e=this.currentElement(),n=null,i=e.parentElement;i&&"HTML"!==i.tagName&&!n;){for(var r=Array.prototype.slice.call(i.children),o=r.indexOf(e),s=o;s>=0;s--){var a=r[s];t.indexOf(a.id)>-1&&!n&&(n=a)}e=i,i=i.parentElement}return n?{id:n.id,index:t.indexOf(n.id)}:n},n.prototype._generateCfi=function(t,e){if(!t||!t.parentElement)var t=this.document.getElementsByTagName("body")[0];return t.parentElement&&t.parentElement.parentElement&&(e=this._generateCfi(t.parentElement,e)),e+2*(Array.prototype.slice.call(t.parentElement.children).indexOf(t)+1)+"/"},n.prototype.generateCfi=function(t,e){var n=this._generateCfi(t,e);return"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),"epubcfi("+n+")"},n.prototype.currentPosition=function(){var t=this.currentElement(),e=this.generateCfi(t,this.section.cfiBase+"!/");return e},i.EventTarget.mixin(n.prototype),e.exports=n},{"./core":10,"./epubcfi":11,rsvp:3}],28:[function(t,e){function n(t){this.container=t,this._views=[],this.length=0,this.hidden=!1}n.prototype.first=function(){return this._views[0]},n.prototype.last=function(){return this._views[this._views.length-1]},n.prototype.each=function(){return this._views.forEach.apply(this._views,arguments)},n.prototype.indexOf=function(t){return this._views.indexOf(t)},n.prototype.slice=function(){return this._views.slice.apply(this._views,arguments)},n.prototype.get=function(t){return this._views[t]},n.prototype.append=function(t){return this._views.push(t),this.container.appendChild(t.element),this.length++,t},n.prototype.prepend=function(t){return this._views.unshift(t),this.container.insertBefore(t.element,this.container.firstChild),this.length++,t},n.prototype.insert=function(t,e){return this._views.splice(e,0,t),e<this.container.children.length?this.container.insertBefore(t.element,this.container.children[e]):this.container.appendChild(t.element),this.length++,t},n.prototype.remove=function(t){var e=this._views.indexOf(t);e>-1&&this._views.splice(e,1),this.destroy(t),this.length--},n.prototype.destroy=function(t){t.off("resized"),t.displayed&&t.destroy(),this.container.removeChild(t.element),t=null},n.prototype.clear=function(){var t,e=this.length;if(this.length){for(var n=0;e>n;n++)t=this._views[n],this.destroy(t);this._views=[],this.length=0}},n.prototype.find=function(t){for(var e,n=this.length,i=0;n>i;i++)if(e=this._views[i],e.displayed&&e.section.index==t.index)return e},n.prototype.displayed=function(){for(var t,e=[],n=this.length,i=0;n>i;i++)t=this._views[i],t.displayed&&e.push(t);return e},n.prototype.show=function(){for(var t,e=this.length,n=0;e>n;n++)t=this._views[n],t.displayed&&t.show();this.hidden=!1},n.prototype.hide=function(){for(var t,e=this.length,n=0;e>n;n++)t=this._views[n],t.displayed&&t.hide();this.hidden=!0},e.exports=n},{}],epub:[function(t,e){function n(t){return new i(t)}var i=t("./book"),r=t("./epubcfi"),o=t("./highlighter"),s=t("rsvp");n.VERSION="0.3.0",n.CFI=r,n.Highlighter=o,n.RSVP=s,e.exports=n},{"./book":8,"./epubcfi":11,"./highlighter":12,rsvp:3}]},{},["epub"])("epub")});